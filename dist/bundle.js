!function(t){var e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(n,o,function(e){return t[e]}.bind(null,o));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=27)}([function(t,e){t.exports=function(t,e,i){this.type=t,this.data=e,this.time=i||Date.now()}},function(t,e,i){var n=i(2);n.renderWithTranslation=function(t,e,i,o,s,r,h){t.save(),n.translateCanvasContext(t,e,i,o,s,r),h(),t.restore()},n.translateCanvasContext=function(t,e,i,n,o,s){t.translate(e,i),(n||o)&&t.scale(n?-1:1,o?-1:1),s&&t.rotate(s)},n.clearCanvasContext=function(t){t.clearRect(0,0,t.canvas.width,t.canvas.height)},n.getWindow=function(){return"undefined"!=typeof window&&window?window:{}},t.exports=n},function(t,e){var i={isFunction:function(t){return"function"==typeof t},linSearch:function(t,e,i){for(var n=0;n<t.length;n++)if(i(t[n],e))return n;return-1},isNullOrUndefined:function(t){return null==t},degreesToRadians:function(t){return t/180*Math.PI},checkCollision:function(t,e,i,n,o,s,r,h){return t<o+r&&t+i>o&&e<s+h&&e+n>s},mergeProperties:function(t,e){var i=Object.keys(t);i&&i.forEach((function(i){e[i]=t[i]}))}};t.exports=i},function(t,e){var i={SCREEN_PAUSED:"SCREEN_PAUSED",SCREEN_RESUMED:"SCREEN_RESUMED",BEFORE_RENDER:"BEFORE_RENDER",AFTER_RENDER:"AFTER_RENDER",MOUSE_MOVE:"MOUSE_MOVE",MOUSE_UP:"MOUSE_UP",MOUSE_DOWN:"MOUSE_DOWN",ELEMENT_MOVED:"ELEMENT_MOVED",ELEMENT_STARTED_MOVING:"ELEMENT_STARTED_MOVING",ELEMENT_STOPPED_MOVING:"ELEMENT_STOPPED_MOVING",ELEMENT_COLLISION:"ELEMENT_COLLISION",MOUSE_ENTER_ELEMENT:"MOUSE_ENTER_ELEMENT",MOUSE_EXIT_ELEMENT:"MOUSE_EXIT_ELEMENT",MOUSE_MOVE_OVER_ELEMENT:"MOUSE_MOVE_OVER_ELEMENT",MOUSE_DOWN_ON_ELEMENT:"MOUSE_DOWN_ON_ELEMENT",MOUSE_UP_ON_ELEMENT:"MOUSE_UP_ON_ELEMENT",ELEMENT_HIT_LEFT_EDGE:"ELEMENT_HIT_LEFT_EDGE",ELEMENT_HIT_RIGHT_EDGE:"ELEMENT_HIT_RIGHT_EDGE",ELEMENT_HIT_TOP_EDGE:"ELEMENT_HIT_TOP_EDGE",ELEMENT_HIT_BOTTOM_EDGE:"ELEMENT_HIT_BOTTOM_EDGE",SPRITE_ANIMATION_DONE:"SPRITE_ANIMATION_DONE",NEXT_FRAME_BEGIN:"NEXT_FRAME_BEGIN",NEXT_FRAME_END:"NEXT_FRAME_END"};t.exports=i},function(t,e,i){var n=i(2),o=i(0);function s(t){t=t||{},this._eventNotifierMixinId=s.id++,this._eventNotifierMixinHandlerId=0,this._EventNotifierMixin_debug=t.EventNotifierMixin_debug||!1,this.EventNotifierMixinInitializer=function(){this._eventListeners={}},this.addEventHandler=function(t,e,i){var n=i||"eventHandler_"+this._eventNotifierMixinId+"."+this._eventNotifierMixinHandlerId;return this._eventNotifierMixinHandlerId++,this._eventListeners[t]||this.registerEventType(t),this._eventListeners[t][n]=e,n},this.registerEventType=function(t){this._eventListeners[t]=this._eventListeners[t]||{}},this.on=this.addEventHandler,this.removeEventHandler=function(t){Object.keys(this._eventListeners).forEach(function(e){this._eventListeners[e][t]&&delete this._eventListeners[e][t]}.bind(this))},this.clearEventHandlers=function(t){!this._eventListeners[t]&&this._EventNotifierMixin_debug&&console.log("Unknown event type:"+t),this._eventListeners[t]={}},this.notify=function(t,e,i){var s=null;if(s=t instanceof o?t:new o(t,e,i),this._eventListeners[s.type])for(var r=Object.keys(this._eventListeners[s.type]),h=0;h<r.length;h++)n.isFunction(this._eventListeners[s.type][r[h]])&&this._eventListeners[s.type][r[h]](s);else this._EventNotifierMixin_debug&&console.log("Unknown event type:"+s.type)}}s.id=0,t.exports=s},function(t,e,i){var n=i(10),o=i(2),s=i(0),r=i(3),h=i(12);function a(t){t=t||{},h.call(this,t),this._elements=[],this._dirtyElements=new n,this._dirtyElements.setInvertPriority(!1),this._removedElements={},this._zIndexCounter=0,this._allElementsRemoved=!1}a.prototype=new h,a.prototype.constructor=a,a.prototype.addElement=function(t){this._elements.push(t),-1===t.getZIndex()&&t.setZIndex(this._zIndexCounter++)},a.prototype.removeElementById=function(t){var e=o.linSearch(this._elements,t,(function(t,e){return t.getId()===e}));return e>-1?this._removeElementByIndex(e):null},a.prototype.removeElement=function(t){return this.removeElementById(t.getId())},a.prototype._removeElementByIndex=function(t){this._removedElements[this._elements[t].getId()]=this._elements[t];var e=this._elements[t];return e.setDirty(!0),e.setHidden(!0),this._dirtyElements.push(e.getZIndexComparable()),e},a.prototype.removeAllElements=function(){for(var t=0;t<this._elements.length;t++)this._removeElementByIndex(t);this._allElementsRemoved=!0},a.prototype.update=function(t,e){var i;for(i=0;i<this._elements.length;i++)this.isDirty()&&this._elements[i].setDirty(!0),this._elements[i].update(t,e)&&this._dirtyElements.push(this._elements[i].getZIndexComparable()),this._checkBorderCollision(this._elements[i],t);this._handleCollisions()},a.prototype._checkBorderCollision=function(t,e){t.getCollisionBoxX()<=0&&t.notify(new s(r.ELEMENT_HIT_LEFT_EDGE,{layer:this,element:t},e)),t.getCollisionBoxX()+t.getCollisionBoxWidth()>this.getWidth()&&t.notify(new s(r.ELEMENT_HIT_RIGHT_EDGE,{layer:this,element:t},e)),t.getCollisionBoxY()<=0&&t.notify(new s(r.ELEMENT_HIT_TOP_EDGE,{layer:this,element:t},e)),t.getCollisionBoxY()+t.getCollisionBoxHeight()>this.getHeight()&&t.notify(new s(r.ELEMENT_HIT_BOTTOM_EDGE,{layer:this,element:t},e))},a.prototype._handleCollisions=function(){for(var t,e,i=0;i<this._elements.length-1;i++){t=this._elements[i];for(var n=i+1;n<this._elements.length;n++)e=this._elements[n],this._collisionCheckElementsIfNeeded(t,e)}},a.prototype._collisionCheckElementsIfNeeded=function(t,e){t.collidesWith(e)&&(this._updateElementOnCollision(t),this._updateElementOnCollision(e))},a.prototype._updateElementOnCollision=function(t){t.setHasCollision(!0),t.setDirty(!0),this._dirtyElements.push(t.getZIndexComparable())},a.prototype.preRender=function(t,e){var i;if(h.prototype.preRender.call(this,t,e),!this.isDirty())for(i=0;i<this._dirtyElements.size();i++)this._dirtyElements.getByIndex(i).getElement().clear(this.getCanvasContextWrapper(),t,e)},a.prototype.render=function(t,e){for(;this._dirtyElements.peek();){var i=this._dirtyElements.pop().getElement();i.preRender(t,e)&&i.render(this.getCanvasContextWrapper(),t,e),i.postRender(t,e)}this._cleanUp()},a.prototype._cleanUp=function(){this._allElementsRemoved?(this._elements=[],this._allElementsRemoved=!1):Object.keys(this._removedElements).forEach(function(t){t=parseInt(t);var e=o.linSearch(this._elements,t,(function(t,e){return t.getId()===e}));this._elements.splice(e,1)}.bind(this)),this._removedElements={},this._dirtyElements.clear()},a.prototype.handleMouseEvent=function(t){for(var e=0;e<this._elements.length;e++)this._elements[e].handleMouseEvent(t)},t.exports=a},function(t,e,i){var n=i(9),o=i(14),s=i(4),r=i(1),h=i(0),a=i(3),l=i(15),p=i(7);function u(t){t=t||{},this._id=u.id++,this._screenContext=t.screenContext,this._scaleX=t.scaleX||1,this._scaleY=t.scaleY||1,this._currentMove=null,this._moveQueue=new n,this._xMoveRate=0,this._xMoveFractionalAccumulator=0,this._yMoveRate=0,this._yMoveFractionalAccumulator=0,this._dirty=!0,this._hasCollision=!1,this._hadCollisionPreviousFrame=!1,this._hidden=t.hidden||!1,this._x=t.x||0,this._y=t.y||0,this._lastX=0,this._lastY=0,this._mouseIsOver=!1,this._zIndex=t.zIndex||-1,this._zIndexComparable=new o(this),this._width=t.width,this._height=t.height,this._rotation=t.rotation||null,this._baseRotation=t.baseRotation||null,this._wasRotated=!!t.rotation,this._scaledDiagonalSize=0,this._rotatedScaledX=0,this._rotatedScaledY=0,this._lastCollisionBoxX=this._x,this._lastCollisionBoxY=this._y,this._lastCollisionBoxWidth=0,this._lastCollisionBoxHeight=0,this._horizontalFlip=t.horizontalFlip||!1,this._verticalFlip=t.verticalFlip||!1,this._flashDoneCallback=null,this._isFlashing=!1,this._flashStartTime=-1,this._flashDuration=0,this._flashHidden=!1,this._flashElapsed=0,this._flashInterval=0,this._nudgeDoneCallback=null,this._isProcessingNudge=!1,this._shakeDoneCallback=null,this._isProcessingShake=!1,this._recalculateRotatedCollisionBox(),this.EventNotifierMixinInitializer()}s.call(u.prototype),u.prototype._baseNotify=u.prototype.notify,u.AntiAliasCorrection={coordinateOffset:-1,sizeAdjustment:2},u.prototype.notify=function(t){this._baseNotify(t),this.getScreenContext().notify(t)},u.id=0,u.prototype.getId=function(){return this._id},u.prototype.isDirty=function(){return this._dirty||this._hasCollision||this._hadCollisionPreviousFrame},u.prototype.setDirty=function(t){this._dirty=t},u.prototype.isHidden=function(){return this._hidden},u.prototype.setHidden=function(t){this._hidden=t},u.prototype.hasCollision=function(){return this._hasCollision},u.prototype.setHasCollision=function(t){this._hasCollision=t},u.prototype.getZIndex=function(){return this._zIndex},u.prototype.setZIndex=function(t){this._zIndex=t,this.setDirty(!0)},u.prototype.getZIndexComparable=function(){return this._zIndexComparable},u.prototype.getScreenContext=function(){return this._screenContext},u.prototype.getScreenScaleX=function(){return this.getScreenContext().getScaleX()},u.prototype.getScreenScaleY=function(){return this.getScreenContext().getScaleY()},u.prototype.getTotalScaleX=function(){return this.getElementScaleX()*this.getScreenContext().getScaleX()},u.prototype.getTotalScaleY=function(){return this.getElementScaleY()*this.getScreenContext().getScaleY()},u.prototype.getElementScaleX=function(){return this._scaleX},u.prototype.getElementScaleY=function(){return this._scaleY},u.prototype.setElementScaleX=function(t){this._scaleX=t},u.prototype.setElementScaleY=function(t){this._scaleY=t},u.prototype.getX=function(){return this._x},u.prototype.getScaledX=function(){return this.getX()*this.getScreenScaleX()},u.prototype.getY=function(){return this._y},u.prototype.getScaledY=function(){return this.getY()*this.getScreenScaleY()},u.prototype.setX=function(t){t!==this._x&&this.setDirty(!0),this._x=t},u.prototype.setY=function(t){t!==this._y&&this.setDirty(!0),this._y=t},u.prototype.getLastX=function(){return this._lastX},u.prototype.getLastY=function(){return this._lastY},u.prototype.getLastWidth=function(){return this.getWidth()},u.prototype.getLastHeight=function(){return this.getHeight()},u.prototype.setLastX=function(t){this._lastX=t},u.prototype.setLastY=function(t){this._lastY=t},u.prototype.isMouseOver=function(){return this._mouseIsOver},u.prototype.getWidth=function(){return this._width},u.prototype.getScaledWidth=function(){return this.getWidth()*this.getTotalScaleX()},u.prototype.getHeight=function(){return this._height},u.prototype.getScaledHeight=function(){return this.getHeight()*this.getTotalScaleY()},u.prototype.getUnAdjustedRotation=function(){return this._rotation},u.prototype.getBaseRotation=function(){return this._baseRotation},u.prototype.getRotation=function(){return this._rotation||this._baseRotation?(this._rotation||0)+(this._baseRotation||0):null},u.prototype.setRotation=function(t){this._rotation=t,null!==this._rotation?(this._recalculateRotatedCollisionBox(),this.setDirty(!0)):this.wasRotated()&&this.setDirty(!0)},u.prototype.setBaseRotation=function(t){this._baseRotation=t,null!==this._baseRotation?(this._recalculateRotatedCollisionBox(),this.setDirty(!0)):this.wasRotated()&&this.setDirty(!0)},u.prototype.wasRotated=function(){return this._wasRotated},u.prototype.setWasRotated=function(t){this._wasRotated=t},u.prototype.hasRotation=function(){return!(r.isNullOrUndefined(this.getRotation())||0===this.getRotation())},u.prototype.getRotatedScaledX=function(){return this._rotatedScaledX},u.prototype.getRotatedScaledY=function(){return this._rotatedScaledY},u.prototype.getScaledDiagonalSize=function(){return this._scaledDiagonalSize},u.prototype._recalculateRotatedCollisionBox=function(){null!==this.getRotation()&&(this._scaledDiagonalSize=Math.ceil(Math.sqrt(Math.pow(this.getScaledWidth(),2)+Math.pow(this.getScaledHeight(),2))),this._rotatedScaledX=Math.floor(this.getScaledX()-(this._scaledDiagonalSize-this.getScaledWidth())/2),this._rotatedScaledY=Math.floor(this.getScaledY()-(this._scaledDiagonalSize-this.getScaledHeight())/2))},u.prototype.isHorizontallyFlipped=function(){return this._horizontalFlip},u.prototype.isVerticallyFlipped=function(){return this._verticalFlip},u.prototype.setHorizontallyFlipped=function(t){this._horizontalFlip!==t&&this.setDirty(!0),this._horizontalFlip=t},u.prototype.setVerticallyFlipped=function(t){this._verticalFlip!==t&&this.setDirty(!0),this._verticalFlip=t},u.prototype.flash=function(t,e,i){this._flashInterval=t,this._flashDuration=e,this._isFlashing=!0,this._flashStartTime=-1,this._flashElapsed=0,this._flashHidden=!1,this._flashDoneCallback=i},u.prototype.isFlashing=function(){return this._isFlashing},u.prototype.turnFlashOff=function(){this._endFlash()},u.prototype._endFlash=function(){this._isFlashing=!1,this._flashStartTime=-1,this._flashElapsed=0,this._flashHidden=!1,r.isFunction(this._flashDoneCallback)&&this._flashDoneCallback()},u.prototype._updateFlash=function(t,e){-1===this._flashStartTime&&(this._flashStartTime=t),t-this._flashStartTime>=this._flashDuration&&this._flashDuration>-1?this._endFlash():(this._flashElapsed+=e,this._flashElapsed>=this._flashInterval&&(this._flashElapsed-=this._flashInterval,this._flashHidden=!this._flashHidden,this.setDirty(!0)))},u.prototype.nudge=function(t,e,i,n,o,s){if(n<0)throw new Error("interval cannot be less than 0");var r,h;this._nudgeDoneCallback=s;for(var a=t>=0?1:-1,l=e>=0?1:-1,p=0;(Math.abs(t)>i||Math.abs(e)>i)&&n>=0;)if(r=this.getX()+t,h=this.getY()+e,this.moveTo(r,h,n),this._isProcessingNudge=!0,n-=o,a*=-1,l*=-1,t=0!==t?a*(Math.abs(t)-i):0,e=0!==e?l*(Math.abs(e)-i):0,++p>1e3)throw new Error("GfxElement.nudge() looped too many times.");this.moveTo(this.getX(),this.getY(),n<0?0:n)},u.prototype.shake=function(t,e,i,n,o,s){if(i<0)throw new Error("interval cannot be less than 0");if(0===n&&!o)throw new Error("must specify either intervalDecay or notToExceedTime");var r,h;this._shakeDoneCallback=s;for(var a=0,l=0,p=t-Math.floor(Math.random()*t*2),u=t-Math.floor(Math.random()*t*2);t>0&&i>0&&l<(o||Number.POSITIVE_INFINITY);)if(r=this.getX()+p,h=this.getY()+u,this.moveTo(r,h,i),this._isProcessingShake=!0,l+=i,i-=n,p=(t-=e)-Math.floor(Math.random()*t*2),u=t-Math.floor(Math.random()*t*2),++a>1e3)throw new Error("GfxElement.shake() looped too many times.");this.moveTo(this.getX(),this.getY(),i<0?0:i)},u.prototype.setMoveRates=function(t,e){0!==t||0!==e||null!==this._currentMove||0===this._xMoveRate&&0===this._yMoveRate?0===t&&0===e||null!==this._currentMove||0!==this._xMoveRate||0!==this._yMoveRate||this.notify(new h(a.ELEMENT_STARTED_MOVING,{element:this})):this.notify(new h(a.ELEMENT_STOPPED_MOVING,{element:this})),this._xMoveRate=t,this._yMoveRate=e},u.prototype.getMoveRateX=function(){return this._xMoveRate},u.prototype.getMoveRateY=function(){return this._yMoveRate},u.prototype.moveTo=function(t,e,i,n){var o=new l(this,t,e,i=i||16,this.moveOrderCallback.bind(this),n);this._moveQueue.push(o),null===this._currentMove&&(this._runMove(),0===this.getMoveRateX()&&0===this.getMoveRateY()&&this.notify(new h(a.ELEMENT_STARTED_MOVING,{element:this})))},u.prototype._runMove=function(){return this._moveQueue.size()>0?(this._currentMove=this._moveQueue.pop(),this._currentMove.start(),!0):(0===this.getMoveRateX()&&0===this.getMoveRateY()&&this.notify(new h(a.ELEMENT_STOPPED_MOVING,{element:this})),this._currentMove=null,!1)},u.prototype.moveOrderCallback=function(){this._currentMove=null,this._runMove()||(this._isProcessingNudge&&(r.isFunction(this._nudgeDoneCallback)&&this._nudgeDoneCallback(),this._isProcessingNudge=!1),this._isProcessingShake&&(r.isFunction(this._shakeDoneCallback)&&this._shakeDoneCallback(),this._isProcessingShake=!1))},u.prototype.clearMoveQueue=function(){this._moveQueue.clear()},u.prototype.turnOff=function(){this._moveQueue.clear(),this._currentMove=null,this._xMoveRate=0,this._xMoveFractionalAccumulator=0,this._yMoveRate=0,this._yMoveFractionalAccumulator=0,this.hide()},u.prototype.show=function(){this._hidden=!1,this.setDirty(!0)},u.prototype.hide=function(){this._hidden=!0,this.setDirty(!0)},u.prototype.update=function(t,e){return this._updateLocationFromMoveRates(t,e),this._updateMoveOrder(t,e),this._isFlashing&&this._updateFlash(t,e),this.getX()===this.getLastX()&&this.getY()===this.getLastY()||(this.setDirty(!0),this.notify(new h(a.ELEMENT_MOVED,{element:this},t))),this.isDirty()?(this._recalculateRotatedCollisionBox(),this):null},u.prototype._updateLocationFromMoveRates=function(t,e){var i,n,o;0!==this._xMoveRate?(i=this._xMoveFractionalAccumulator+e*this._xMoveRate/1e3,n=Math.sign(i),o=Math.trunc(i),this._xMoveFractionalAccumulator=n*(Math.abs(i)-Math.abs(o)),this._x+=o,this._x!==this._lastX&&this.setDirty(!0)):this._xMoveFractionalAccumulator=0,0!==this._yMoveRate?(i=this._yMoveFractionalAccumulator+e*this._yMoveRate/1e3,n=Math.sign(i),o=Math.trunc(i),this._yMoveFractionalAccumulator=n*(Math.abs(i)-Math.abs(o)),this._y+=o,this._y!==this._lastY&&this.setDirty(!0)):this._yMoveFractionalAccumulator=0},u.prototype._updateMoveOrder=function(t,e){null!==this._currentMove&&(this._currentMove.update(t,e),this.setDirty(!0))},u.prototype.clear=function(t,e,i){t.clearRect(this._lastCollisionBoxX,this._lastCollisionBoxY,this._lastCollisionBoxWidth,this._lastCollisionBoxHeight)},u.prototype.preRender=function(t,e){return!(this.isHidden()||this._flashHidden||!this.isDirty())},u.prototype.render=function(t,e,i){throw new Error("Not Implemented.")},u.prototype.postRender=function(t,e){this.setLastX(this.getX()),this.setLastY(this.getY()),this.hasRotation()?this.setWasRotated(!0):this.setWasRotated(!1),this._saveLastCollisionBox(),this._hadCollisionPreviousFrame=this.hasCollision(),this.setHasCollision(!1),this.setDirty(!1)},u.prototype._saveLastCollisionBox=function(){this._lastCollisionBoxX=this.getCollisionBoxX(),this._lastCollisionBoxY=this.getCollisionBoxY(),this._lastCollisionBoxWidth=this.getCollisionBoxWidth(),this._lastCollisionBoxHeight=this.getCollisionBoxHeight()},u.prototype.collidesWith=function(t){var e=this.getCollisionBoxX(),i=t.getCollisionBoxX(),n=this.getCollisionBoxWidth(),o=t.getCollisionBoxWidth(),s=this.getCollisionBoxY(),r=t.getCollisionBoxY(),l=this.getCollisionBoxHeight(),p=t.getCollisionBoxHeight(),u=e<i+o&&e+n>i&&s<r+p&&s+l>r;return!u||this.isHidden()||t.isHidden()||(this.notify(new h(a.ELEMENT_COLLISION,{element1:this,element2:t})),t.notify(new h(a.ELEMENT_COLLISION,{element1:t,element2:this}))),u},u.prototype.collidesWithCoordinates=function(t,e){return t>=this.getCollisionBoxX()&&t<=this.getCollisionBoxX()+this.getCollisionBoxWidth()&&e>=this.getCollisionBoxY()&&e<=this.getCollisionBoxY()+this.getCollisionBoxHeight()},u.prototype.collidesWithX=function(t){return t>=this.getCollisionBoxX()&&t<=this.getCollisionBoxX()+this.getCollisionBoxWidth()},u.prototype.collidesWithY=function(t){return t>=this.getCollisionBoxY()&&t<=this.getCollisionBoxY()+this.getCollisionBoxHeight()},u.prototype.getCollisionBoxX=function(){return this.hasRotation()?this.getRotatedScaledX()+u.AntiAliasCorrection.coordinateOffset:this.getScaledX()+u.AntiAliasCorrection.coordinateOffset},u.prototype.getCollisionBoxY=function(){return this.hasRotation()?this.getRotatedScaledY()+u.AntiAliasCorrection.coordinateOffset:this.getScaledY()+u.AntiAliasCorrection.coordinateOffset},u.prototype.getCollisionBoxWidth=function(){return this.hasRotation()?this.getScaledDiagonalSize()+u.AntiAliasCorrection.sizeAdjustment:this.getScaledWidth()+u.AntiAliasCorrection.sizeAdjustment},u.prototype.getCollisionBoxHeight=function(){return this.hasRotation()?this.getScaledDiagonalSize()+u.AntiAliasCorrection.sizeAdjustment:this.getScaledHeight()+u.AntiAliasCorrection.sizeAdjustment},u.prototype.handleMouseEvent=function(t){var e=this._setupSecondaryEventData(t),i=[];if(this.collidesWithCoordinates(t.data.viewOriginAdjustedX,t.data.viewOriginAdjustedY)){this.isMouseOver()||i.push(new p(a.MOUSE_ENTER_ELEMENT,e,t.data.time)),this._mouseIsOver=!0;var n=null;switch(t.type){case a.MOUSE_MOVE:n=a.MOUSE_MOVE_OVER_ELEMENT;break;case a.MOUSE_DOWN:n=a.MOUSE_DOWN_ON_ELEMENT;break;case a.MOUSE_UP:n=a.MOUSE_UP_ON_ELEMENT}i.push(new p(n,e,t.data.time))}else this.isMouseOver()&&(i.push(new p(a.MOUSE_EXIT_ELEMENT,e,t.data.time)),this._mouseIsOver=!1);for(var o=0;o<i.length;o++){var s=i[o];this.notify(s),s.endEventPropagation&&(t.endEventPropagation=!0)}},u.prototype._setupSecondaryEventData=function(t){return{x:t.data.x,y:t.data.y,viewOriginAdjustedX:t.data.viewOriginAdjustedX,viewOriginAdjustedY:t.data.viewOriginAdjustedY,rawX:t.data.rawX,rawY:t.data.rawY,element:this}},t.exports=u},function(t,e,i){var n=i(0);function o(t,e,i){n.call(this,t,e,i),this.endEventPropagation=!1}o.prototype=new n,o.prototype.constructor=o,t.exports=o},function(t,e){function i(){this._heapSize=0,this._a=[],this.invertPriority=!1}i.IComparable=function(){},i.IComparable.prototype.compareTo=function(t){throw new Error("not implemented")},i.IComparable.prototype.equals=function(t){throw new Error("not implemented")},i.prototype.setInvertPriority=function(t){this.invertPriority=t,this.sort()},i.prototype.sort=function(){this._buildMaxHeap();for(var t=this._heapSize-1;t>=1;t--)this._swap(0,t),this._maxHeapify(0,this._heapSize-(this._heapSize-t))},i.prototype._maxHeapify=function(t,e,i){var n=0,o=2*t+1,s=2*t+2;void 0===i&&(i=this.invertPriority?-1:1),n=o<e&&this._a[o].compareTo(this._a[t])===i?o:t,s<e&&this._a[s].compareTo(this._a[n])===i&&(n=s),n!=t&&(this._swap(t,n),this._maxHeapify(n,e,i))},i.prototype._swap=function(t,e){var i=this._a[t];this._a[t]=this._a[e],this._a[e]=i},i.prototype._buildMaxHeap=function(){for(var t=Math.floor((this._heapSize-1)/2);t>=0;t--)this._maxHeapify(t,this._heapSize)},i.prototype.extractMax=function(){if(this._heapSize<1)return null;var t=this._a[0];return this._a[0]=this._a[this._heapSize-1],this._heapSize--,this._maxHeapify(0,this._heapSize,this.invertPriority?1:-1),t},i.prototype.insert=function(t){var e=this._heapSize;this._heapSize===this._a.length?this._a.push(t):this._a[e]=t,this._heapSize++,this.increaseKey(e)},i.prototype.increaseKey=function(t){for(;t>0&&this._a[this._parent(t)].compareTo(this._a[t])===(this.invertPriority?-1:1);)this._swap(t,this._parent(t)),t=this._parent(t)},i.prototype.decreaseKey=function(t){this._maxHeapify(t,this._heapSize,this.invertPriority?1:-1)},i.prototype.getByIndex=function(t){if(t>this._heapSize||t<0)throw new Error("Index out of bounds: "+t+". (queue size:"+this._heapSize+")");return this._a[t]},i.prototype.getByEquality=function(t){var e=this.indexOf(t);return-1===e?null:this._a[e]},i.prototype.size=function(){return this._heapSize},i.prototype.contains=function(t){for(var e=0;e<this._heapSize;e++)if(t.equals(this._a[e]))return!0;return!1},i.prototype.indexOf=function(t){for(var e=0;e<this._heapSize;e++)if(t.equals(this._a[e]))return e;return-1},i.prototype.remove=function(t){if(!(this._heapSize<1)){var e=this.indexOf(t);e<0||(this._a[e]=this._a[this._heapSize-1],this._heapSize--,this._maxHeapify(e,this._heapSize,this.invertPriority?1:-1))}},i.prototype.clear=function(){this._heapSize=0},i.prototype._verifyHeap=function(t){if(null==t&&(t=0),t>=this._heapSize)return!0;var e=this.invertPriority?1:-1,i=2*t+1,n=2*t+2,o=!0;return i<this._heapSize&&this._a[i].compareTo(this._a[t])===e&&(o=!1),o&&n<this._heapSize&&this._a[n].compareTo(this._a[t])===e&&(o=!1),o&&i<this._heapSize&&(o=this._verifyHeap(i))&&n<this._heapSize&&(o=this._verifyHeap(n)),o},i.prototype._parent=function(t){return Math.floor((t-1)/2)},i.prototype.pop=i.prototype.extractMax,i.prototype.poll=i.prototype.extractMax,i.prototype.push=i.prototype.insert,i.prototype.peek=function(){return this._heapSize<1?null:this._a[0]},t.exports=i},function(t,e,i){var n=i(2),o=function(){this.head=null,this.tail=null,this._size=0};o.prototype.push=function(t){var e=new s(t,null);0===this._size?this.head=e:this.tail.next=e,this.tail=e,this._size++},o.prototype.pop=function(){var t=this.head;return null!==this.head&&(this.head=this.head.next,this._size--),null===t?null:t.elem},o.prototype.clear=function(){this.head=null,this.tail=null,this._size=0},o.prototype.newIterator=function(){return new o.QueueIterator(this.head)},o.prototype.contains=function(t){for(var e=this.newIterator(),i=null;null!==(i=e.getCurrent());){if(i===t||n.isFunction(i.equals)&&i.equals(t))return!0;e.next()}return!1},o.prototype.getByEquality=function(t){for(var e=this.newIterator(),i=null;null!==(i=e.getCurrent());){if(i===t||n.isFunction(i.equals)&&i.equals(t))return i;e.next()}return null},o.prototype.size=function(){return this._size};var s=function(t,e){this.elem=t,this.next=e};(o.QueueIterator=function(t){this._ptr=t}).prototype.getCurrent=function(){return null===this._ptr?null:this._ptr.elem},o.QueueIterator.prototype.next=function(){this._ptr=null===this._ptr?null:this._ptr.next},t.exports=o},function(t,e,i){var n=i(8),o=i(2);function s(){n.call(this),this._entryKeys={}}s.prototype=new n,s.prototype.constructor=s,s.prototype.insert=function(t){this._entryKeys[t.getKey()]||(this._entryKeys[t.getKey()]=!0,n.prototype.insert.call(this,t))},s.prototype.clear=function(){this._entryKeys={},n.prototype.clear.call(this)},s.prototype.extractMax=function(){var t=n.prototype.extractMax.call(this);return t&&o.isFunction(t.getKey)&&this._entryKeys[t.getKey()]&&delete this._entryKeys[t.getKey()],t},s.prototype.contains=function(t){return!0===this._entryKeys[t.getKey()]},s.prototype.remove=function(t){n.prototype.remove.call(this,t),this._entryKeys[t.getKey()]&&delete this._entryKeys[t.getKey()]},s.prototype.pop=s.prototype.extractMax,s.prototype.poll=s.prototype.extractMax,s.prototype.push=s.prototype.insert,t.exports=s},function(t,e,i){var n=i(5);function o(t){t=t||{},n.call(this,t)}o.prototype=new n,o.prototype.constructor=o,o.prototype.update=function(t,e){var i;for(i=0;i<this._elements.length;i++)this.isDirty()&&this._elements[i].setDirty(!0),this._elements[i].update(t,e)&&this._dirtyElements.push(this._elements[i].getZIndexComparable())},t.exports=o},function(t,e,i){var n=i(2);function o(t){t=t||{},this._width=t.width||320,this._height=t.height||200,this._canvasContextWrapper=t.canvasContextWrapper,this._dirty=!0,this._pendingViewOriginX=null,this._pendingViewOriginY=null}o.prototype.isDirty=function(){return this._dirty},o.prototype.setDirty=function(t){this._dirty=t},o.prototype.setViewOriginX=function(t){this._pendingViewOriginX=t,null!==this._pendingViewOriginX&&this._pendingViewOriginX!==this.getViewOriginX()&&this.setDirty(!0)},o.prototype.setViewOriginY=function(t){this._pendingViewOriginY=t,null!==this._pendingViewOriginY&&this._pendingViewOriginY!==this.getViewOriginY()&&this.setDirty(!0)},o.prototype.getViewOriginX=function(){return this._canvasContextWrapper.getViewOriginX()},o.prototype.getViewOriginY=function(){return this._canvasContextWrapper.getViewOriginY()},o.prototype.getPendingViewOriginX=function(){return this._pendingViewOriginX},o.prototype.getPendingViewOriginY=function(){return this._pendingViewOriginY},o.prototype.getWidth=function(){return this._width},o.prototype.getHeight=function(){return this._height},o.prototype.getCanvasContextWrapper=function(){return this._canvasContextWrapper},o.prototype.isImageSmoothingEnabled=function(){return this._canvasContextWrapper.isImageSmoothingEnabled()},o.prototype.setImageSmoothingEnabled=function(t){this._canvasContextWrapper.setImageSmoothingEnabled(t),this.setDirty(!0)},o.prototype.update=function(t,e){},o.prototype.render=function(t,e){},o.prototype.preRender=function(t,e){this.isDirty()&&this.getCanvasContextWrapper().clear(),n.isNullOrUndefined(this.getPendingViewOriginX())||(this.getCanvasContextWrapper().setViewOriginX(this.getPendingViewOriginX()),this._pendingViewOriginX=null),n.isNullOrUndefined(this.getPendingViewOriginY())||(this.getCanvasContextWrapper().setViewOriginY(this.getPendingViewOriginY()),this._pendingViewOriginY=null)},o.prototype.postRender=function(t,e){this.setDirty(!1)},o.prototype.handleMouseEvent=function(t){},o.prototype.clearLayer=function(){this._canvasContextWrapper.clearRect(0,0,this.getWidth(),this.getHeight())},o.prototype.dimLayer=function(t,e,i){var n=t/e;setTimeout(this._dimStep.bind(this,n,n,e,i),i)},o.prototype._dimStep=function(t,e,i,n){var o=this.getCanvasContextWrapper();o.clearRect(0,0,this.getWidth(),this.getHeight()),o.fillStyle="rgba(0,0,0,"+t+")",o.fillRect(0,0,this.getWidth(),this.getHeight()),i>0&&setTimeout(this._dimStep.bind(this,t+e,e,i-1,n),n)},t.exports=o},function(t,e){function i(t){this._width=t.width,this._height=t.height,this._canvasContext=t.canvasContext,this._viewOriginX=t.viewOriginX||0,this._viewOriginY=t.viewOriginY||0,this.setImageSmoothingEnabled(t.imageSmoothingEnabled||!1)}i.prototype.getViewOriginX=function(){return this._viewOriginX},i.prototype.getViewOriginY=function(){return this._viewOriginY},i.prototype.setViewOriginX=function(t){this._viewOriginX=t},i.prototype.setViewOriginY=function(t){this._viewOriginY=t},i.prototype.getCanvasContext=function(){return this._canvasContext},i.prototype.isImageSmoothingEnabled=function(){return this._canvasContext.imageSmoothingEnabled},i.prototype.setImageSmoothingEnabled=function(t){this._canvasContext.imageSmoothingEnabled=t},i.prototype.clearRect=function(t,e,i,n){this.isOutOfView(t,e,i,n)||this._canvasContext.clearRect(t+this._viewOriginX,e+this._viewOriginY,i,n)},i.prototype.clear=function(){this._canvasContext.clearRect(0,0,this._width,this._height)},i.prototype.fillRect=function(t,e,i,n){this.isOutOfView(t,e,i,n)||this._canvasContext.fillRect(t+this._viewOriginX,e+this._viewOriginY,i,n)},i.prototype.drawImage=function(t,e,i,n,o,s,r,h,a){this.isOutOfView(s,r,h,a)||this._canvasContext.drawImage(t,e,i,n,o,s+this._viewOriginX,r+this._viewOriginY,h,a)},i.prototype.drawImageWithTranslation=function(t,e,i,n,o,s,r,h,a){this._canvasContext.drawImage(t,e,i,n,o,s,r,h,a)},i.prototype.fillRectWithTranslation=function(t,e,i,n){this._canvasContext.fillRect(t,e,i,n)},i.prototype.save=function(){this._canvasContext.save()},i.prototype.restore=function(){this._canvasContext.restore()},i.prototype.translate=function(t,e){this._canvasContext.translate(t+this._viewOriginX,e+this._viewOriginY)},i.prototype.scale=function(t,e){this._canvasContext.scale(t,e)},i.prototype.rotate=function(t){this._canvasContext.rotate(t)},i.prototype.isOutOfView=function(t,e,i,n){return this._viewOriginX+t+i<0||this._viewOriginX+t>this._width||this._viewOriginY+e+n<0||this._viewOriginY+e>this._height},i.prototype.setFillStyle=function(t){this._canvasContext.fillStyle=t},i.prototype.beginPath=function(){this._canvasContext.beginPath()},i.prototype.moveTo=function(t,e){this._canvasContext.moveTo(this._viewOriginX+t,this._viewOriginY+e)},i.prototype.lineTo=function(t,e){this._canvasContext.lineTo(this._viewOriginX+t,this._viewOriginY+e)},i.prototype.closePath=function(){this._canvasContext.closePath()},i.prototype.stroke=function(){this._canvasContext.stroke()},i.prototype.rect=function(t,e,i,n){this._canvasContext.rect(t,e,i,n)},i.prototype.setLineWidth=function(t){this._canvasContext.lineWidth=t},i.prototype.setStrokeStyle=function(t){this._canvasContext.strokeStyle=t},i.prototype.strokeRect=function(t,e,i,n){this._canvasContext.strokeRect(t,e,i,n)},i.prototype.fillText=function(t,e,i,n){this._canvasContext.fillText(t,e,i,n)},i.prototype.strokeText=function(t,e,i,n){this._canvasContext.strokeText(t,e,i,n)},i.prototype.setFontStyle=function(t){this._canvasContext.font=t},i.prototype.setTextAlign=function(t){this._canvasContext.textAlign=t},i.prototype.setTextBaseline=function(t){this._canvasContext.textBaseline=t},i.prototype.setTextDirection=function(t){this._canvasContext.direction=t},t.exports=i},function(t,e){function i(t){this._parentElement=t}i.prototype.getElement=function(){return this._parentElement},i.prototype.compareTo=function(t){return this._parentElement.getZIndex()<t._parentElement.getZIndex()?-1:this._parentElement.getZIndex()===t._parentElement.getZIndex()?0:1},i.prototype.equals=function(t){return this._parentElement.getZIndex()===t._parentElement.getZIndex()},i.prototype.getKey=function(){return this._parentElement.getId()},t.exports=i},function(t,e,i){var n=i(1);function o(t,e,i,n,o,s){this._element=t,this._tx=e,this._ty=i,this._startX=0,this._startY=0,this._duration=n,this._elementCallback=o,this._callback=s,this._end=!1,this._started=!1,this._startTime=-1}o.prototype.start=function(){this._startX=this._element.getX(),this._startY=this._element.getY(),this._started=!0},o.prototype.update=function(t,e){if(this._started&&!this._end){-1===this._startTime&&(this._startTime=t);var i=this._timePercent(t);i>=1?this.end():(this._element.setX(this._startX+(this._tx-this._startX)*i),this._element.setY(this._startY+(this._ty-this._startY)*i))}},o.prototype.end=function(){this._end=!0,this._element.setX(this._tx),this._element.setY(this._ty),n.isFunction(this._elementCallback)&&this._elementCallback(),n.isFunction(this._callback)&&this._callback(this._element)},o.prototype._timePercent=function(t){return(t-this._startTime)/this._duration},t.exports=o},function(t,e,i){var n=i(1);function o(t,e){this._screenScaleX=t,this._screenScaleY=e}o.prototype.renderImage=function(t,e,i,n,o,s,r,h,a,l,p,u,_,c,d){_||c||d?this.renderImageWithTranslation(t,e,i,n,o,s,r,h,a,l,p,u,_,c,d):t.drawImage(e,i,n,o,s,r*this.getScreenScaleX(),h*this.getScreenScaleY(),a*this.getTotalScaleX(p),l*this.getTotalScaleY(u))},o.prototype.renderImageWithTranslation=function(t,e,i,o,s,r,h,a,l,p,u,_,c,d,g){var f=h*this.getScreenScaleX()+l*this.getTotalScaleX(u)/2,y=a*this.getScreenScaleY()+p*this.getTotalScaleY(_)/2;n.renderWithTranslation(t,f,y,c,d,g,function(){t.drawImageWithTranslation(e,i,o,s,r,0-l*this.getTotalScaleX(u)/2,0-p*this.getTotalScaleY(_)/2,l*this.getTotalScaleX(u),p*this.getTotalScaleY(_))}.bind(this))},o.prototype.getScreenScaleX=function(){return this._screenScaleX},o.prototype.getScreenScaleY=function(){return this._screenScaleY},o.prototype.getTotalScaleX=function(t){return this._screenScaleX*t},o.prototype.getTotalScaleY=function(t){return this._screenScaleY*t},t.exports=o},function(t,e,i){var n=i(6),o=i(3),s=i(0);function r(t){t=t||{},n.call(this,t),this._frames=t.frames||[],this._ttl=t.ttl||-1,this._loop=!1!==t.loop,this._loopsToLive=t.loopsToLive||-1,this._freezeFrameIdx=t.freezeFrameIdx||-1,this._fidx=0,this._currentFrameElapsed=0,this._done=!1,this._loopCount=0,this._elapsed=0}r.prototype=new n,r.prototype.constructor=r,r.prototype.getFrames=function(){return this._frames},r.prototype.setFrames=function(t){this._frames=t},r.prototype.addFrame=function(t){this._frames.push(t)},r.prototype.getTtl=function(){return this._ttl},r.prototype.setTtl=function(t){this._ttl=t},r.prototype.doesLoop=function(){return this._loop},r.prototype.setDoLoop=function(t){this._loop=t},r.prototype.getLoopsToLive=function(){return this._loopsToLive},r.prototype.setLoopsToLive=function(t){this._loopsToLive=t},r.prototype.isDone=function(){return this._done},r.prototype.setDone=function(t){this._done=t,t&&this.doEndOfAnimation()},r.prototype.getFreezeFrameIndex=function(){return this._freezeFrameIdx},r.prototype.setFreezeFrameIndex=function(t){this._freezeFrameIdx=t},r.prototype.getLoopCount=function(){return this._loopCount},r.prototype.getCurrentFrameIndex=function(){return this._fidx},r.prototype.setCurrentFrameIndex=function(t){this._fidx=t,this.setDirty(!0)},r.prototype.reset=function(){this.setCurrentFrameIndex(0),this._currentFrameElapsed=0,this._done=!1,this._loopCount=0,this._elapsed=0,this.setDirty(!0)},r.prototype.update=function(t,e){return n.prototype.update.call(this,t,e),0===this._frames.length||this._done?null:(this._updateTtl(e),this._updateFrame(e),this._done&&this.doEndOfAnimation(),this.isDirty()?this:null)},r.prototype._updateFrame=function(t){if(this._currentFrameElapsed+=t,this._currentFrameElapsed>=this._frames[this._fidx].getDuration()){for(;this._currentFrameElapsed>=this._frames[this._fidx].getDuration();)this._currentFrameElapsed-=this._frames[this._fidx].getDuration(),this._fidx++,this._fidx===this._frames.length&&(this._fidx=0,this._loopCount++,this._loop?this._loopsToLive>-1&&this._loopCount>=this._loopsToLive&&(this._done=!0):(this._done=!0,this._freezeFrameIdx>-1&&(this._fidx=this._freezeFrameIdx)));this.setDirty(!0)}},r.prototype._updateTtl=function(t){this._ttl>-1&&(this._elapsed+=t,this._elapsed>=this._ttl&&(this._done=!0))},r.prototype.render=function(t,e,i){this.renderFrame(t,e,i,this._frames[this._fidx])},r.prototype.renderFrame=function(t,e,i){},r.prototype.doEndOfAnimation=function(){var t=new s(o.SPRITE_ANIMATION_DONE,{element:this});this.notify(t)},t.exports=r},function(t,e){function i(){}i.prototype.getDuration=function(){throw new Error("getDuration Not Implemented on this AnimationFrame")},t.exports=i},function(t,e,i){var n=i(1),o=i(5),s=i(11);function r(t){t=t||{},this._registeredTypes={},Object.keys(r.DefaultTypes).forEach(function(t){this._registeredTypes[t]=r.DefaultTypes[t]}.bind(this)),Object.keys(t).forEach(function(e){this._registeredTypes[e]=t[e]}.bind(this))}r.prototype.getLayer=function(t,e){var i=null,o=this._registeredTypes[t];return o&&n.isFunction(o)&&(i=o(e)),i},r.DefaultTypes={GfxLayer:function(t){return new o(t)},BackgroundLayer:function(t){return new s(t)}},t.exports=r},function(t,e,i){function n(){this.EventNotifierMixinInitializer({eventListeners:[]})}i(4).call(n.prototype),t.exports=n},function(t,e){function i(){}i.prototype.getLayer=function(t,e){throw new Error("getLayer() Not Implemented.")},t.exports=i},function(t,e,i){var n=i(6);function o(t){t=t||{},n.call(this,t),this._image=t.image,this._sx=t.sourceX,this._sy=t.sourceY,this._sWidth=t.sourceWidth,this._sHeight=t.sourceHeight,this._imageRenderer=t.imageRenderer}o.prototype=new n,o.prototype.constructor=o,o.prototype.getImage=function(){return this._image},o.prototype.getWidth=function(){return this._width},o.prototype.getHeight=function(){return this._height},o.prototype.getSourceX=function(){return this._sx},o.prototype.getSourceY=function(){return this._sy},o.prototype.getSourceWidth=function(){return this._sWidth},o.prototype.getSourceHeight=function(){return this._sHeight},o.prototype.render=function(t,e,i){this._imageRenderer.renderImage(t,this.getImage(),this.getSourceX(),this.getSourceY(),this.getSourceWidth(),this.getSourceHeight(),this.getX(),this.getY(),this.getWidth(),this.getHeight(),this.getElementScaleX(),this.getElementScaleY(),this.isHorizontallyFlipped(),this.isVerticallyFlipped(),this.getRotation())},t.exports=o},function(t,e,i){var n=i(1).getWindow();function o(t){this.imagesHash=t,this.imageCount=0,this.imageLoadedCounter=0}o.Image=n.Image||function(){return{}},o.prototype.loadImages=function(t){this.imagesDoneLoadingCallback=t;var e=Object.keys(this.imagesHash);this.imageCount=e.length;for(var i=null,n=0;n<e.length;n++)i=e[n],this.imagesHash[i].image=new o.Image,this.imagesHash[i].image.src=this.imagesHash[i].path,this.imagesHash[i].image.onload=this.loadImagesCallback.bind(this)},o.prototype.loadImagesCallback=function(){this.imageLoadedCounter++,this.imageLoadedCounter===this.imageCount&&this.imagesDoneLoadingCallback(this.imagesHash)},t.exports=o},function(t,e,i){var n=i(17);i(16);function o(t){t=t||{},n.call(this,t),this._image=t.image,this._width=t.width,this._height=t.height,this._imageRenderer=t.imageRenderer}o.prototype=new n,o.prototype.constructor=o,o.prototype.getImage=function(){return this._image},o.prototype.renderFrame=function(t,e,i,n){this._imageRenderer.renderImage(t,this.getImage(),n.getSourceX(),n.getSourceY(),n.getSourceWidth(),n.getSourceHeight(),this.getX(),this.getY(),this.getWidth(),this.getHeight(),this.getElementScaleX(),this.getElementScaleY(),this.isHorizontallyFlipped(),this.isVerticallyFlipped(),this.getRotation())},t.exports=o},function(t,e,i){var n=i(18);function o(t){t=t||{},n.call(this),this._duration=t.duration,this._sx=t.sourceX,this._sy=t.sourceY,this._sWidth=t.sourceWidth,this._sHeight=t.sourceHeight}o.prototype=new n,o.prototype.constructor=o,o.prototype.getDuration=function(){return this._duration},o.prototype.getSourceX=function(){return this._sx},o.prototype.getSourceY=function(){return this._sy},o.prototype.getSourceWidth=function(){return this._sWidth},o.prototype.getSourceHeight=function(){return this._sHeight},t.exports=o},function(t,e,i){function n(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function o(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var s=i(19),r=i(1),h=i(3),a=i(4),l=i(13),p=i(0),u=i(7),_=r.getWindow();function c(t){t=t||{},this._targetDiv=t.targetDiv,this._layerFactory=t.layerFactory||new s,this._scaleX=t.scaleX||1,this._scaleY=t.scaleY||1,this._width=(t.width||640)*this._scaleX,this._height=(t.height||480)*this._scaleY,this._fpsElem=t.fpsElem||null,this._imageSmoothingEnabled=t.imageSmoothingEnabled||!1,this._avgTime=0,this._last=0,this._mouseX=-1,this._mouseY=-1,this._mouseMoved=!1,this._paused=!1,this._unpaused=!1,this._useMouseMoveEvents=!!r.isNullOrUndefined(t.useMouseMoveEvents)||t.useMouseMoveEvents,this._backgroundColor=t.backgroundColor||"black",this._borderColor=t.borderColor||"grey",this._setBorderSize(t.borderSize||1),this._fpsMonitorArray=[],this._fpsMonitorIndex=0,this._viewOriginX=0,this._viewOriginY=0,this._pendingViewOriginX=null,this._pendingViewOriginY=null,this._layers=[],this._requestAnimationFrame=t.requestAnimationFrame||(_.requestAnimationFrame?_.requestAnimationFrame.bind(_):function(){}),this.EventNotifierMixinInitializer()}a.call(c.prototype),c.mockDocument={addEventListener:function(){},createElement:function(){return{style:{},getContext:function(){return{}}}},hidden:!1},c.document=_.document||c.mockDocument,c.prototype.initialize=function(){this._prepareDiv(),this._setupEventListeners()},c.prototype._setBorderSize=function(t){this._borderSize="number"==typeof t?t+"px":t},c.prototype.setViewOriginX=function(t){this._pendingViewOriginX=t,null!==this._pendingViewOriginX&&this._pendingViewOriginX!==this.getViewOriginX()&&this.getLayers().forEach((function(e){e.setViewOriginX(t)}))},c.prototype.setViewOriginY=function(t){this._pendingViewOriginY=t,null!==this._pendingViewOriginY&&this._pendingViewOriginY!==this.getViewOriginY()&&this.getLayers().forEach((function(e){e.setViewOriginY(t)}))},c.prototype.getViewOriginX=function(){return this._viewOriginX},c.prototype.getViewOriginY=function(){return this._viewOriginY},c.prototype.getPendingViewOriginX=function(){return this._pendingViewOriginX},c.prototype.getPendingViewOriginY=function(){return this._pendingViewOriginY},c.prototype._prepareDiv=function(){this._targetDiv.style.width=this._width,this._targetDiv.style.height=this._height,this._targetDiv.style.backgroundColor=this._backgroundColor,this._targetDiv.style.border=this._borderSize+" solid "+this._borderColor},c.prototype._setupEventListeners=function(){this._targetDiv.addEventListener("mouseup",this.handleMouseEvent.bind(this),!0),this._targetDiv.addEventListener("mousedown",this.handleMouseEvent.bind(this),!0),this._useMouseMoveEvents&&this._targetDiv.addEventListener("mousemove",this.handleMouseMoveEvent.bind(this),!0),c.document.addEventListener("visibilitychange",this.handleVisibilityChange.bind(this),!1)},c.prototype.handleVisibilityChange=function(){this._tabNotVisible=c.document.hidden,this._tabNotVisible||this._paused||(this._unpaused=!0,this._requestAnimationFrame(this.render.bind(this)))},c.prototype.addEventListenerToDocument=function(t,e){c.document.addEventListener(t,e)},c.prototype.setBackgroundColor=function(t){this._backgroundColor=t,this._targetDiv.style.backgroundColor=t},c.prototype.getBackgroundColor=function(t){return this._backgroundColor},c.prototype.setBorderColor=function(t){this._borderColor=t,this._targetDiv.style.borderColor=t},c.prototype.getBorderColor=function(){return this._borderColor},c.prototype.setBorderSize=function(t){this._setBorderSize(t),this._targetDiv.style.borderWidth=this._borderSize},c.prototype.getBorderSize=function(){return this._targetDiv.style.borderWidth},c.prototype.getBorderTopSize=function(){return this._targetDiv.style.borderTopWidth},c.prototype.getBorderLeftSize=function(){return this._targetDiv.style.borderLeftWidth},c.prototype.getBorderRightSize=function(){return this._targetDiv.style.borderRightWidth},c.prototype.getBorderBottomSize=function(){return this._targetDiv.style.borderBottomWidth},c.prototype.getWidth=function(){return this._width},c.prototype.getHeight=function(){return this._height},c.prototype.getScaleX=function(){return this._scaleX},c.prototype.getScaleY=function(){return this._scaleY},c.prototype.getMouseX=function(){return this._mouseX},c.prototype.getMouseY=function(){return this._mouseY},c.prototype.isImageSmoothingEnabled=function(){return this._imageSmoothingEnabled},c.prototype.setImageSmoothingEnabled=function(t){this._imageSmoothingEnabled=t},c.prototype.createLayer=function(t,e){e=e||{};var i=this.createCanvasForLayer(),s=this.createCanvasContextWrapper(i),r=function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?n(Object(i),!0).forEach((function(e){o(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):n(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({},e);r.width=r.width||this.getWidth(),r.height=r.height||this.getHeight(),r.canvasContextWrapper=s;var h=this._layerFactory.getLayer(t,r);return this.addLayer(h),h},c.prototype.createCanvasForLayer=function(){var t=c.document.createElement("CANVAS");return this._targetDiv.appendChild(t),t.width=this._width,t.height=this._height,t.style.position="absolute",t},c.prototype.createCanvasContextWrapper=function(t){return new l({canvasContext:t.getContext("2d"),imageSmoothingEnabled:this._imageSmoothingEnabled,width:this._width,height:this._height})},c.prototype.addLayer=function(t){this._layers.push(t)},c.prototype.getLayers=function(){return this._layers},c.prototype.setPaused=function(t){this._paused&&!t&&(this._unpaused=!0),this._paused=t,this.notify(new p(this._paused?h.SCREEN_PAUSED:h.SCREEN_RESUMED)),this._paused||this._requestAnimationFrame(this.render.bind(this))},c.prototype.onNextFrameBegin=function(t){return this.on(h.NEXT_FRAME_BEGIN,t)},c.prototype.onNextFrameEnd=function(t){return this.on(h.NEXT_FRAME_END,t)},c.prototype._doBeforeRenderEvents=function(t,e){this.notify(new p(h.NEXT_FRAME_BEGIN,{diff:e},t)),this.clearEventHandlers(h.NEXT_FRAME_BEGIN),this.notify(new p(h.BEFORE_RENDER,{diff:e},t))},c.prototype._doAfterRenderEvents=function(t,e){this.notify(new p(h.NEXT_FRAME_END,{diff:e},t)),this.clearEventHandlers(h.NEXT_FRAME_END),this.notify(new p(h.AFTER_RENDER,{diff:e},t))},c.prototype.isPaused=function(){return this._paused},c.prototype.render=function(t){if(t=t||1,!this._paused&&!this._tabNotVisible){this._unpaused&&(this._unpaused=!1,this._last=Math.floor(t)-1),t=Math.floor(t);var e=Date.now(),i=t-this._last;this._last=t,this._mouseMoved&&this._handleMouseMoveEvent(t),this._doBeforeRenderEvents(t,i),this._updateFps(i),this._update(t,i),this._render(t,i),this._updateViewOrigins(),this._doAfterRenderEvents(t,i),e=Date.now()-e,this._fpsElem&&0===this._fpsMonitorIndex&&(this._fpsElem.innerHTML+="<br />Avg MS per frame: "+e),this._requestAnimationFrame(this.render.bind(this))}},c.prototype._updateViewOrigins=function(){r.isNullOrUndefined(this.getPendingViewOriginX())||(this._viewOriginX=this.getPendingViewOriginX(),this._pendingViewOriginX=null),r.isNullOrUndefined(this.getPendingViewOriginY())||(this._viewOriginY=this.getPendingViewOriginY(),this._pendingViewOriginY=null)},c.prototype._handleMouseMoveEvent=function(t){var e=this._getCoordinateDataForMouseEvent(this._mouseX,this._mouseY),i=new u(h.MOUSE_MOVE,e,t);this.propagateMouseEventThroughLayers(i),i.endEventPropagation||this.notify(i),this._mouseMoved=!1},c.prototype._updateFps=function(t){if(this._fpsElem){var e=Math.floor(1e3/t);this._fpsMonitorArray.length<30?this._fpsMonitorArray.push(e):this._fpsMonitorArray[this._fpsMonitorIndex]=e,this._fpsMonitorIndex++,this._fpsMonitorIndex>=30&&(this._fpsMonitorIndex=0);for(var i=1,n=0;n<this._fpsMonitorArray.length;n++)i+=this._fpsMonitorArray[n]/30;this._fpsElem&&0===this._fpsMonitorIndex&&(this._fpsElem.innerHTML="fps: "+Math.floor(i))}},c.prototype._update=function(t,e){for(var i=0;i<this._layers.length;i++)this._layers[i].update(t,e)},c.prototype._render=function(t,e){for(var i=0;i<this._layers.length;i++)this._layers[i].preRender(t,e),this._layers[i].render(t,e),this._layers[i].postRender(t,e)},c.prototype.handleMouseMoveEvent=function(t){if(this._paused)return!1;this._mouseMoved=!0;var e=this.getXFromMouseEvent(t),i=this.getYFromMouseEvent(t);if(e<0||e>=this._width||i<0||i>=this._height)return this._mouseX=-1,this._mouseY=-1,!1;this._mouseX=e,this._mouseY=i},c.prototype._getCoordinateDataForMouseEvent=function(t,e){var i=this.getViewOriginAdjustedX(t),n=this.getViewOriginAdjustedY(e);return{x:this.getUnScaledX(i),y:this.getUnScaledY(n),viewOriginAdjustedX:i,viewOriginAdjustedY:n,rawX:t,rawY:e}},c.prototype.handleMouseEvent=function(t){if(this._paused)return!1;var e=this.getXFromMouseEvent(t),i=this.getYFromMouseEvent(t);if(e<0||e>=this._width||i<0||i>=this._height)return!1;var n=this._getCoordinateDataForMouseEvent(e,i);n.baseEvent=t;var o="mouseup"===t.type?h.MOUSE_UP:h.MOUSE_DOWN,s=new u(o,n);return this.propagateMouseEventThroughLayers(s),s.endEventPropagation||this.notify(s),1!==t.button&&void 0},c.prototype.propagateMouseEventThroughLayers=function(t){for(var e=this._layers.length-1;e>=0;e--){if(t.endEventPropagation)return;this._layers[e].handleMouseEvent(t)}},c.prototype.getXFromMouseEvent=function(t){return t.pageX-(this._targetDiv.offsetLeft+parseInt(this.getBorderLeftSize()))},c.prototype.getYFromMouseEvent=function(t){return t.pageY-(this._targetDiv.offsetTop+parseInt(this.getBorderTopSize()))},c.prototype.getUnScaledX=function(t){return Math.floor(t/this.getScaleX())},c.prototype.getUnScaledY=function(t){return Math.floor(t/this.getScaleY())},c.prototype.getViewOriginAdjustedX=function(t){return t-this.getViewOriginX()},c.prototype.getViewOriginAdjustedY=function(t){return t-this.getViewOriginY()},c.prototype.setBorder=function(t,e,i){this._targetDiv.style.borderWidth=t,this._targetDiv.style.borderStyle=e,this._targetDiv.style.borderColor=i},t.exports=c},function(t,e,i){"use strict";i.r(e);var n=i(0),o=i.n(n),s=i(20),r=i.n(s),h=i(4),a=i.n(h),l=i(8),p=i.n(l),u=i(9),_=i.n(u),c=i(10),d=i.n(c),g=i(11),f=i.n(g),y=i(13),E=i.n(y),v=i(3),m=i.n(v),x=i(6),S=i.n(x),M=i(14),O=i.n(M),C=i(5),w=i.n(C),T=i(21),b=i.n(T),I=i(22),D=i.n(I),L=i(23),X=i.n(L),R=i(16),Y=i.n(R),N=i(24),F=i.n(N),H=i(25),B=i.n(H),V=i(12),z=i.n(V),A=i(19),W=i.n(A),P=i(7),k=i.n(P),U=i(15),j=i.n(U),G=i(26),K=i.n(G),q=i(17),Z=i.n(q),Q=i(18),J=i.n(Q),$=i(1),tt=i.n($);"undefined"!=typeof self&&self&&(self.SL=self.SL||{},self.SL.Event=o.a,self.SL.EventManager=r.a,self.SL.EventNotifierMixin=a.a,self.SL.PriorityQueue=p.a,self.SL.Queue=_.a,self.SL.UniquePriorityQueue=d.a,self.SL.BackgroundLayer=f.a,self.SL.CanvasContextWrapper=E.a,self.SL.EventType=m.a,self.SL.GfxElement=S.a,self.SL.GfxElementZIndexComparable=O.a,self.SL.GfxLayer=w.a,self.SL.ILayerFactory=b.a,self.SL.ImageElement=D.a,self.SL.ImageLoader=X.a,self.SL.ImageRenderer=Y.a,self.SL.ImageSprite=F.a,self.SL.ImageSpriteFrame=B.a,self.SL.Layer=z.a,self.SL.LayerFactory=W.a,self.SL.MouseEvent=k.a,self.SL.MoveOrder=j.a,self.SL.Screen=K.a,self.SL.Sprite=Z.a,self.SL.SpriteAnimationFrame=J.a,self.SL.Utils=tt.a)}]);
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.slgfx=e():t.slgfx=e()}(this,(function(){return(()=>{"use strict";var t={543:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Event=void 0;e.Event=function(t,e,i){this.type=t,this.data=e,this.time=i||Date.now()}},734:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.EventManager=void 0;var n=i(543),o=function(){function t(){this._eventManagerId=t.EventManagerId++,this._eventManagerListenerId=0,this._eventListeners={},this.on=this.addEventListener}return t.prototype.addEventListener=function(t,e,i){var n=i||"eventListener_"+this._eventManagerId+"."+this._eventManagerListenerId;return this._eventManagerListenerId++,this._eventListeners[t]||this.registerEventType(t),this._eventListeners[t][n]=e,n},t.prototype.registerEventType=function(t){this._eventListeners[t]=this._eventListeners[t]||{}},t.prototype.removeEventListener=function(t){var e=this;Object.keys(this._eventListeners).forEach((function(i){e._eventListeners[i][t]&&delete e._eventListeners[i][t]}))},t.prototype.clearEventListeners=function(t){this._eventListeners[t]={}},t.prototype.notify=function(t,e,i){var o;if(o=t instanceof n.Event?t:new n.Event(t,e,i),this._eventListeners[o.type])for(var r in this._eventListeners[o.type])this._eventListeners[o.type][r](o)},t.EventManagerId=0,t}();e.EventManager=o},724:function(t,e){var i=this&&this.__spreadArray||function(t,e,i){if(i||2===arguments.length)for(var n,o=0,r=e.length;o<r;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))};Object.defineProperty(e,"__esModule",{value:!0}),e.PriorityQueue=void 0;var n=function(){function t(){this._heapSize=0,this._a=[],this._invertPriority=!1,this._maxHeapify=function(t,e,i){var n=0,o=2*t+1,r=2*t+2;void 0===i&&(i=this.invertPriority?-1:1),n=o<e&&this._a[o].compareTo(this._a[t])===i?o:t,r<e&&this._a[r].compareTo(this._a[n])===i&&(n=r),n!=t&&(this._swap(t,n),this._maxHeapify(n,e,i))}}return t.prototype.setInvertPriority=function(t){this._invertPriority=t,this._sort()},Object.defineProperty(t.prototype,"invertPriority",{get:function(){return this._invertPriority},set:function(t){this._invertPriority=t,this._sort()},enumerable:!1,configurable:!0}),t.prototype._sort=function(){this._buildMaxHeap();for(var t=this._heapSize-1;t>=1;t--)this._swap(0,t),this._maxHeapify(0,this._heapSize-(this._heapSize-t))},t.prototype.toSortedArray=function(){return this._sort(),i([],this._a,!0)},t.prototype._swap=function(t,e){var i=this._a[t];this._a[t]=this._a[e],this._a[e]=i},t.prototype._buildMaxHeap=function(){for(var t=Math.floor((this._heapSize-1)/2);t>=0;t--)this._maxHeapify(t,this._heapSize)},t.prototype.extractMax=function(){if(this._heapSize<1)return null;var t=this._a[0];return this._a[0]=this._a[this._heapSize-1],this._heapSize--,this._maxHeapify(0,this._heapSize,this._invertPriority?1:-1),t},t.prototype.insert=function(t){var e=this._heapSize;this._heapSize===this._a.length?this._a.push(t):this._a[e]=t,this._heapSize++,this._increaseKey(e)},t.prototype._increaseKey=function(t){for(;t>0&&this._a[this._parent(t)].compareTo(this._a[t])===(this.invertPriority?-1:1);)this._swap(t,this._parent(t)),t=this._parent(t)},t.prototype.updateElement=function(t){var e=this._a.indexOf(t);this._increaseKey(e)},t.prototype.getByIndex=function(t){if(t>this._heapSize||t<0)throw new Error("Index out of bounds: "+t+". (queue size:"+this._heapSize+")");return this._a[t]},t.prototype.filter=function(t){return this._a.filter(t)},t.prototype.size=function(){return this._heapSize},Object.defineProperty(t.prototype,"length",{get:function(){return this._heapSize},enumerable:!1,configurable:!0}),t.prototype.contains=function(t){for(var e=0;e<this._heapSize;e++)if(t.equals(this._a[e]))return!0;return!1},t.prototype.indexOf=function(t){for(var e=0;e<this._heapSize;e++)if(t.equals(this._a[e]))return e;return-1},t.prototype.remove=function(t){if(!(this._heapSize<1)){var e=this.indexOf(t);e<0||(this._a[e]=this._a[this._heapSize-1],this._heapSize--,this._maxHeapify(e,this._heapSize,this._invertPriority?1:-1))}},t.prototype.clear=function(){this._heapSize=0,this._a=[]},t.prototype._parent=function(t){return Math.floor((t-1)/2)},t.prototype.pop=function(){return this.extractMax()},t.prototype.poll=function(){return this.extractMax()},t.prototype.push=function(t){this.insert(t)},t.prototype.peek=function(){return this._heapSize<1?null:this._a[0]},t}();e.PriorityQueue=n},971:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.StringToWordTokens=e.omitSpecialCharacters=void 0,e.omitSpecialCharacters=["\\!","@","#","\\$","%","\\^","&","\\*","\\(","\\)","_","=","\\+",",","\\.","<",">","/","\\\\","\\?","\\[","\\]","\\{","\\}","\\|","`","\\~",'"',";",":"],e.StringToWordTokens=function(t,e){return t&&0!==t.length?(e&&e.forEach((function(e){t=t.replace(new RegExp(e,"g")," ")})),t.match(/(\S+)/g)):[]}},153:function(t,e,i){var n,o=this&&this.__extends||(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.UniquePriorityQueue=void 0;var r=i(724),s=i(629),a=function(t){function e(){var e=t.call(this)||this;return e._entryKeys={},e}return o(e,t),e.prototype.insert=function(t){this._entryKeys[t.getKey()]||(this._entryKeys[t.getKey()]=!0,r.PriorityQueue.prototype.insert.call(this,t))},e.prototype.clear=function(){this._entryKeys={},r.PriorityQueue.prototype.clear.call(this)},e.prototype.extractMax=function(){var t=r.PriorityQueue.prototype.extractMax.call(this);return t&&s.Utils.isFunction(t.getKey)&&this._entryKeys[t.getKey()]&&delete this._entryKeys[t.getKey()],t},e.prototype.contains=function(t){return!0===this._entryKeys[t.getKey()]},e.prototype.remove=function(t){r.PriorityQueue.prototype.remove.call(this,t),this._entryKeys[t.getKey()]&&delete this._entryKeys[t.getKey()]},e.prototype.pop=function(){return this.extractMax()},e.prototype.poll=function(){return this.extractMax()},e.prototype.push=function(t){this.insert(t)},e}(r.PriorityQueue);e.UniquePriorityQueue=a},629:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Utils=void 0;var i=function(){function t(){}return t.isFunction=function(t){return"function"==typeof t},t.isNullOrUndefined=function(t){return null==t},t.degreesToRadians=function(t){return t/180*Math.PI},t.checkCollision=function(t,e,i,n,o,r,s,a){return t<o+s&&t+i>o&&e<r+a&&e+n>r},t}();e.Utils=i},57:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Utils=e.UniquePriorityQueue=e.omitSpecialCharacters=e.StringToWordTokens=e.PriorityQueue=e.EventManager=e.Event=void 0;var n=i(543);Object.defineProperty(e,"Event",{enumerable:!0,get:function(){return n.Event}});var o=i(734);Object.defineProperty(e,"EventManager",{enumerable:!0,get:function(){return o.EventManager}});var r=i(724);Object.defineProperty(e,"PriorityQueue",{enumerable:!0,get:function(){return r.PriorityQueue}});var s=i(971);Object.defineProperty(e,"StringToWordTokens",{enumerable:!0,get:function(){return s.StringToWordTokens}}),Object.defineProperty(e,"omitSpecialCharacters",{enumerable:!0,get:function(){return s.omitSpecialCharacters}});var a=i(153);Object.defineProperty(e,"UniquePriorityQueue",{enumerable:!0,get:function(){return a.UniquePriorityQueue}});var h=i(629);Object.defineProperty(e,"Utils",{enumerable:!0,get:function(){return h.Utils}})},493:function(t,e,i){var n,o=this&&this.__extends||(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.BackgroundLayer=void 0;var r=function(t){function e(e){return t.call(this,e)||this}return o(e,t),e.prototype.update=function(t,e){var i;for(i=0;i<this._elements.length;i++)this.isDirty()&&this._elements[i].setDirty(!0),this._elements[i].update(t,e)&&this._dirtyElements.push(this._elements[i].getZIndexComparable())},e}(i(531).GfxLayer);e.BackgroundLayer=r},657:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.CanvasContextWrapper=void 0;var i=function(){function t(t){this._width=t.width,this._height=t.height,this._canvasContext=t.canvasContext,this._viewOriginX=t.viewOriginX||0,this._viewOriginY=t.viewOriginY||0,this.setImageSmoothingEnabled(t.imageSmoothingEnabled||!1)}return Object.defineProperty(t.prototype,"canvas",{get:function(){return this._canvasContext.canvas},enumerable:!1,configurable:!0}),t.prototype.getViewOriginX=function(){return this._viewOriginX},t.prototype.getViewOriginY=function(){return this._viewOriginY},t.prototype.setViewOriginX=function(t){this._viewOriginX=t},t.prototype.setViewOriginY=function(t){this._viewOriginY=t},t.prototype.getCanvasContext=function(){return this._canvasContext},t.prototype.isImageSmoothingEnabled=function(){return this._canvasContext.imageSmoothingEnabled},t.prototype.setImageSmoothingEnabled=function(t){this._canvasContext.imageSmoothingEnabled=t},t.prototype.clearRect=function(t,e,i,n){this.isOutOfView(t,e,i,n)||this._canvasContext.clearRect(t+this._viewOriginX,e+this._viewOriginY,i,n)},t.prototype.clear=function(){this._canvasContext.clearRect(0,0,this._width,this._height)},t.prototype.fillRect=function(t,e,i,n){this.isOutOfView(t,e,i,n)||this._canvasContext.fillRect(t+this._viewOriginX,e+this._viewOriginY,i,n)},t.prototype.drawImage=function(t,e,i,n,o,r,s,a,h){this.isOutOfView(r,s,a,h)||this._canvasContext.drawImage(t,e,i,n,o,r+this._viewOriginX,s+this._viewOriginY,a,h)},t.prototype.drawImageWithTranslation=function(t,e,i,n,o,r,s,a,h){this._canvasContext.drawImage(t,e,i,n,o,r,s,a,h)},t.prototype.fillRectWithTranslation=function(t,e,i,n){this._canvasContext.fillRect(t,e,i,n)},t.prototype.save=function(){this._canvasContext.save()},t.prototype.restore=function(){this._canvasContext.restore()},t.prototype.translate=function(t,e){this._canvasContext.translate(t+this._viewOriginX,e+this._viewOriginY)},t.prototype.scale=function(t,e){this._canvasContext.scale(t,e)},t.prototype.rotate=function(t){this._canvasContext.rotate(t)},t.prototype.isOutOfView=function(t,e,i,n){return this._viewOriginX+t+i<0||this._viewOriginX+t>this._width||this._viewOriginY+e+n<0||this._viewOriginY+e>this._height},t.prototype.setFillStyle=function(t){this._canvasContext.fillStyle=t},t.prototype.beginPath=function(){this._canvasContext.beginPath()},t.prototype.moveTo=function(t,e){this._canvasContext.moveTo(this._viewOriginX+t,this._viewOriginY+e)},t.prototype.lineTo=function(t,e){this._canvasContext.lineTo(this._viewOriginX+t,this._viewOriginY+e)},t.prototype.closePath=function(){this._canvasContext.closePath()},t.prototype.stroke=function(){this._canvasContext.stroke()},t.prototype.rect=function(t,e,i,n){this._canvasContext.rect(t,e,i,n)},t.prototype.setLineWidth=function(t){this._canvasContext.lineWidth=t},t.prototype.setStrokeStyle=function(t){this._canvasContext.strokeStyle=t},t.prototype.strokeRect=function(t,e,i,n){this._canvasContext.strokeRect(t,e,i,n)},t.prototype.fillText=function(t,e,i,n){this._canvasContext.fillText(t,e,i,n)},t.prototype.strokeText=function(t,e,i,n){this._canvasContext.strokeText(t,e,i,n)},t.prototype.setFontStyle=function(t){this._canvasContext.font=t},t.prototype.setTextAlign=function(t){this._canvasContext.textAlign=t},t.prototype.setTextBaseline=function(t){this._canvasContext.textBaseline=t},t.prototype.setTextDirection=function(t){this._canvasContext.direction=t},t}();e.CanvasContextWrapper=i},555:(t,e)=>{var i;Object.defineProperty(e,"__esModule",{value:!0}),e.EventType=void 0,(i=e.EventType||(e.EventType={})).SCREEN_PAUSED="SCREEN_PAUSED",i.SCREEN_RESUMED="SCREEN_RESUMED",i.BEFORE_RENDER="BEFORE_RENDER",i.AFTER_RENDER="AFTER_RENDER",i.MOUSE_MOVE="MOUSE_MOVE",i.MOUSE_UP="MOUSE_UP",i.MOUSE_DOWN="MOUSE_DOWN",i.ELEMENT_MOVED="ELEMENT_MOVED",i.ELEMENT_STARTED_MOVING="ELEMENT_STARTED_MOVING",i.ELEMENT_STOPPED_MOVING="ELEMENT_STOPPED_MOVING",i.ELEMENT_COLLISION="ELEMENT_COLLISION",i.MOUSE_ENTER_ELEMENT="MOUSE_ENTER_ELEMENT",i.MOUSE_EXIT_ELEMENT="MOUSE_EXIT_ELEMENT",i.MOUSE_MOVE_OVER_ELEMENT="MOUSE_MOVE_OVER_ELEMENT",i.MOUSE_DOWN_ON_ELEMENT="MOUSE_DOWN_ON_ELEMENT",i.MOUSE_UP_ON_ELEMENT="MOUSE_UP_ON_ELEMENT",i.ELEMENT_HIT_LEFT_EDGE="ELEMENT_HIT_LEFT_EDGE",i.ELEMENT_HIT_RIGHT_EDGE="ELEMENT_HIT_RIGHT_EDGE",i.ELEMENT_HIT_TOP_EDGE="ELEMENT_HIT_TOP_EDGE",i.ELEMENT_HIT_BOTTOM_EDGE="ELEMENT_HIT_BOTTOM_EDGE",i.SPRITE_ANIMATION_DONE="SPRITE_ANIMATION_DONE",i.NEXT_FRAME_BEGIN="NEXT_FRAME_BEGIN",i.NEXT_FRAME_END="NEXT_FRAME_END"},388:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.GfxElement=void 0;var n=i(57),o=i(833),r=i(555),s=i(163),a=i(438),h=function(){function t(e){this._id=t.id++,this.on=this.addEventListener,this._id=t.id++,this._gfxPanel=e.gfxPanel,this._scaleX=e.scaleX||1,this._scaleY=e.scaleY||1,this._currentMove=null,this._moveQueue=[],this._xMoveRate=0,this._xMoveFractionalAccumulator=0,this._yMoveRate=0,this._yMoveFractionalAccumulator=0,this._dirty=!0,this._hasCollision=!1,this._hadCollisionPreviousFrame=!1,this._hidden=e.hidden||!1,this._x=e.x||0,this._y=e.y||0,this._lastX=0,this._lastY=0,this._mouseIsOver=!1,this._zIndex=e.zIndex||-1,this._zIndexComparable=new s.GfxElementZIndexComparable(this),this._rotation=e.rotation||null,this._baseRotation=e.baseRotation||null,this._wasRotated=!!e.rotation,this._scaledDiagonalSize=0,this._rotatedScaledX=0,this._rotatedScaledY=0,this._lastCollisionBoxX=this._x,this._lastCollisionBoxY=this._y,this._lastCollisionBoxWidth=0,this._lastCollisionBoxHeight=0,this._horizontalFlip=e.horizontalFlip||!1,this._verticalFlip=e.verticalFlip||!1,this._flashDoneCallback=null,this._isFlashing=!1,this._flashStartTime=-1,this._flashDuration=0,this._flashHidden=!1,this._flashElapsed=0,this._flashInterval=0,this._nudgeDoneCallback=null,this._isProcessingNudge=!1,this._shakeDoneCallback=null,this._isProcessingShake=!1,this._eventManager=e.eventManager||new n.EventManager,this._recalculateRotatedCollisionBox()}return t.prototype.addEventListener=function(t,e,i){return this._eventManager.addEventListener(t,e,i)},t.prototype.removeEventListener=function(t){this._eventManager.removeEventListener(t)},t.prototype.clearEventListeners=function(t){this._eventManager.clearEventListeners(t)},t.prototype.notify=function(t,e,i){var o;o=t instanceof n.Event?t:new n.Event(t,e,i),this._eventManager.notify(o),this.getGfxPanel().notify(o)},t.prototype.getId=function(){return this._id},t.prototype.isDirty=function(){return this._dirty||this._hasCollision||this._hadCollisionPreviousFrame},t.prototype.setDirty=function(t){this._dirty=t},t.prototype.isHidden=function(){return this._hidden},t.prototype.setHidden=function(t){this._hidden=t,this._dirty=!0},t.prototype.hasCollision=function(){return this._hasCollision},t.prototype.setHasCollision=function(t){this._hasCollision=t},t.prototype.getZIndex=function(){return this._zIndex},t.prototype.setZIndex=function(t){this._zIndex=t,this.setDirty(!0)},t.prototype.getZIndexComparable=function(){return this._zIndexComparable},t.prototype.getGfxPanel=function(){return this._gfxPanel},t.prototype.getPanelScaleX=function(){return this.getGfxPanel().getScaleX()},t.prototype.getPanelScaleY=function(){return this.getGfxPanel().getScaleY()},t.prototype.getTotalScaleX=function(){return this.getElementScaleX()*this.getGfxPanel().getScaleX()},t.prototype.getTotalScaleY=function(){return this.getElementScaleY()*this.getGfxPanel().getScaleY()},t.prototype.getElementScaleX=function(){return this._scaleX},t.prototype.getElementScaleY=function(){return this._scaleY},t.prototype.setElementScaleX=function(t){this._scaleX=t},t.prototype.setElementScaleY=function(t){this._scaleY=t},t.prototype.getX=function(){return this._x},t.prototype.getScaledX=function(){return this.getX()*this.getPanelScaleX()},t.prototype.getY=function(){return this._y},t.prototype.getScaledY=function(){return this.getY()*this.getPanelScaleY()},t.prototype.setX=function(t){t!==this._x&&this.setDirty(!0),this._x=t},t.prototype.setY=function(t){t!==this._y&&this.setDirty(!0),this._y=t},t.prototype.getLastX=function(){return this._lastX},t.prototype.getLastY=function(){return this._lastY},t.prototype.setLastX=function(t){this._lastX=t},t.prototype.setLastY=function(t){this._lastY=t},t.prototype.isMouseOver=function(){return this._mouseIsOver},t.prototype.getScaledWidth=function(){return this.getWidth()*this.getTotalScaleX()},t.prototype.getScaledHeight=function(){return this.getHeight()*this.getTotalScaleY()},t.prototype.getUnAdjustedRotation=function(){return this._rotation},t.prototype.getBaseRotation=function(){return this._baseRotation},t.prototype.getRotation=function(){return this._rotation||this._baseRotation?(this._rotation||0)+(this._baseRotation||0):null},t.prototype.setRotation=function(t){this._rotation=t,null!==this._rotation?(this._recalculateRotatedCollisionBox(),this.setDirty(!0)):this.wasRotated()&&this.setDirty(!0)},t.prototype.setBaseRotation=function(t){this._baseRotation=t,null!==this._baseRotation?(this._recalculateRotatedCollisionBox(),this.setDirty(!0)):this.wasRotated()&&this.setDirty(!0)},t.prototype.wasRotated=function(){return this._wasRotated},t.prototype.setWasRotated=function(t){this._wasRotated=t},t.prototype.hasRotation=function(){return!(n.Utils.isNullOrUndefined(this.getRotation())||0===this.getRotation())},t.prototype.getRotatedScaledX=function(){return this._rotatedScaledX},t.prototype.getRotatedScaledY=function(){return this._rotatedScaledY},t.prototype.getScaledDiagonalSize=function(){return this._scaledDiagonalSize},t.prototype._recalculateRotatedCollisionBox=function(){null!==this.getRotation()&&(this._scaledDiagonalSize=Math.ceil(Math.sqrt(Math.pow(this.getScaledWidth(),2)+Math.pow(this.getScaledHeight(),2))),this._rotatedScaledX=Math.floor(this.getScaledX()-(this._scaledDiagonalSize-this.getScaledWidth())/2),this._rotatedScaledY=Math.floor(this.getScaledY()-(this._scaledDiagonalSize-this.getScaledHeight())/2))},t.prototype.isHorizontallyFlipped=function(){return this._horizontalFlip},t.prototype.isVerticallyFlipped=function(){return this._verticalFlip},t.prototype.setHorizontallyFlipped=function(t){this._horizontalFlip!==t&&this.setDirty(!0),this._horizontalFlip=t},t.prototype.setVerticallyFlipped=function(t){this._verticalFlip!==t&&this.setDirty(!0),this._verticalFlip=t},t.prototype.flash=function(t,e,i){this._flashInterval=t,this._flashDuration=e,this._isFlashing=!0,this._flashStartTime=-1,this._flashElapsed=0,this._flashHidden=!1,this._flashDoneCallback=i},t.prototype.isFlashing=function(){return this._isFlashing},t.prototype.turnFlashOff=function(){this._endFlash()},t.prototype._endFlash=function(){this._isFlashing=!1,this._flashStartTime=-1,this._flashElapsed=0,this._flashHidden=!1,n.Utils.isFunction(this._flashDoneCallback)&&this._flashDoneCallback()},t.prototype._updateFlash=function(t,e){-1===this._flashStartTime&&(this._flashStartTime=t),t-this._flashStartTime>=this._flashDuration&&this._flashDuration>-1?this._endFlash():(this._flashElapsed+=e,this._flashElapsed>=this._flashInterval&&(this._flashElapsed-=this._flashInterval,this._flashHidden=!this._flashHidden,this.setDirty(!0)))},t.prototype.nudge=function(t,e,i,n,o,r){if(n<0)throw new Error("interval cannot be less than 0");var s,a;this._nudgeDoneCallback=r;for(var h=t>=0?1:-1,l=e>=0?1:-1,u=0;(Math.abs(t)>i||Math.abs(e)>i)&&n>=0;)if(s=this.getX()+t,a=this.getY()+e,this.moveTo(s,a,n),this._isProcessingNudge=!0,n-=o,l*=-1,t=0!==t?(h*=-1)*(Math.abs(t)-i):0,e=0!==e?l*(Math.abs(e)-i):0,++u>1e3)throw new Error("GfxElement.nudge() looped too many times.");this.moveTo(this.getX(),this.getY(),n<0?0:n)},t.prototype.shake=function(t,e,i,n,o,r){if(i<0)throw new Error("interval cannot be less than 0");if(0===n&&!o)throw new Error("must specify either intervalDecay or notToExceedTime");var s,a;this._shakeDoneCallback=r;for(var h=0,l=0,u=t-Math.floor(Math.random()*t*2),p=t-Math.floor(Math.random()*t*2);t>0&&i>0&&l<(o||Number.POSITIVE_INFINITY);)if(s=this.getX()+u,a=this.getY()+p,this.moveTo(s,a,i),this._isProcessingShake=!0,l+=i,i-=n,u=(t-=e)-Math.floor(Math.random()*t*2),p=t-Math.floor(Math.random()*t*2),++h>1e3)throw new Error("GfxElement.shake() looped too many times.");this.moveTo(this.getX(),this.getY(),i<0?0:i)},t.prototype.setMoveRates=function(t,e){0!==t||0!==e||null!==this._currentMove||0===this._xMoveRate&&0===this._yMoveRate?0===t&&0===e||null!==this._currentMove||0!==this._xMoveRate||0!==this._yMoveRate||this.notify(new n.Event(r.EventType.ELEMENT_STARTED_MOVING,{element:this})):this.notify(new n.Event(r.EventType.ELEMENT_STOPPED_MOVING,{element:this})),this._xMoveRate=t,this._yMoveRate=e},t.prototype.getMoveRateX=function(){return this._xMoveRate},t.prototype.getMoveRateY=function(){return this._yMoveRate},t.prototype.moveTo=function(t,e,i,o){i=i||16;var s=new a.MoveOrder(this,t,e,i,this._moveOrderCallback.bind(this),o);this._moveQueue.push(s),null===this._currentMove&&(this._runMove(),0===this.getMoveRateX()&&0===this.getMoveRateY()&&this.notify(new n.Event(r.EventType.ELEMENT_STARTED_MOVING,{element:this})))},t.prototype._runMove=function(){return this._moveQueue.length>0?(this._currentMove=this._moveQueue.shift(),this._currentMove.start(),!0):(0===this.getMoveRateX()&&0===this.getMoveRateY()&&this.notify(new n.Event(r.EventType.ELEMENT_STOPPED_MOVING,{element:this})),this._currentMove=null,!1)},t.prototype._moveOrderCallback=function(){this._currentMove=null,this._runMove()||(this._isProcessingNudge&&(n.Utils.isFunction(this._nudgeDoneCallback)&&this._nudgeDoneCallback(),this._isProcessingNudge=!1),this._isProcessingShake&&(n.Utils.isFunction(this._shakeDoneCallback)&&this._shakeDoneCallback(),this._isProcessingShake=!1))},t.prototype.clearMoveQueue=function(){this._moveQueue=[]},t.prototype.turnOff=function(){this.clearMoveQueue(),this._currentMove=null,this._xMoveRate=0,this._xMoveFractionalAccumulator=0,this._yMoveRate=0,this._yMoveFractionalAccumulator=0,this.hide()},t.prototype.show=function(){this._hidden=!1,this.setDirty(!0)},t.prototype.hide=function(){this._hidden=!0,this.setDirty(!0)},t.prototype.update=function(t,e){return this._updateLocationFromMoveRates(e),this._updateMoveOrder(t,e),this._isFlashing&&this._updateFlash(t,e),this.getX()===this.getLastX()&&this.getY()===this.getLastY()||(this.setDirty(!0),this.notify(new n.Event(r.EventType.ELEMENT_MOVED,{element:this},t))),this.isDirty()?(this._recalculateRotatedCollisionBox(),this):null},t.prototype._updateLocationFromMoveRates=function(t){var e,i,n;0!==this._xMoveRate?(e=this._xMoveFractionalAccumulator+t*this._xMoveRate/1e3,i=Math.sign(e),n=Math.trunc(e),this._xMoveFractionalAccumulator=i*(Math.abs(e)-Math.abs(n)),this._x+=n,this._x!==this._lastX&&this.setDirty(!0)):this._xMoveFractionalAccumulator=0,0!==this._yMoveRate?(e=this._yMoveFractionalAccumulator+t*this._yMoveRate/1e3,i=Math.sign(e),n=Math.trunc(e),this._yMoveFractionalAccumulator=i*(Math.abs(e)-Math.abs(n)),this._y+=n,this._y!==this._lastY&&this.setDirty(!0)):this._yMoveFractionalAccumulator=0},t.prototype._updateMoveOrder=function(t,e){null!==this._currentMove&&(this._currentMove.update(e),this.setDirty(!0))},t.prototype.clear=function(t){t.clearRect(this._lastCollisionBoxX,this._lastCollisionBoxY,this._lastCollisionBoxWidth,this._lastCollisionBoxHeight)},t.prototype.preRender=function(t,e){return!(this.isHidden()||this._flashHidden||!this.isDirty())},t.prototype.postRender=function(t,e){this.setLastX(this.getX()),this.setLastY(this.getY()),this.hasRotation()?this.setWasRotated(!0):this.setWasRotated(!1),this._saveLastCollisionBox(),this._hadCollisionPreviousFrame=this.hasCollision(),this.setHasCollision(!1),this.setDirty(!1)},t.prototype._saveLastCollisionBox=function(){this._lastCollisionBoxX=this.getCollisionBoxX(),this._lastCollisionBoxY=this.getCollisionBoxY(),this._lastCollisionBoxWidth=this.getCollisionBoxWidth(),this._lastCollisionBoxHeight=this.getCollisionBoxHeight()},t.prototype.collidesWith=function(t){var e=this.getCollisionBoxX(),i=t.getCollisionBoxX(),o=this.getCollisionBoxWidth(),s=t.getCollisionBoxWidth(),a=this.getCollisionBoxY(),h=t.getCollisionBoxY(),l=this.getCollisionBoxHeight(),u=t.getCollisionBoxHeight(),p=e<i+s&&e+o>i&&a<h+u&&a+l>h;return!p||this.isHidden()||t.isHidden()||(this.notify(new n.Event(r.EventType.ELEMENT_COLLISION,{element1:this,element2:t})),t.notify(new n.Event(r.EventType.ELEMENT_COLLISION,{element1:t,element2:this}))),p},t.prototype.collidesWithCoordinates=function(t,e){return t>=this.getCollisionBoxX()&&t<=this.getCollisionBoxX()+this.getCollisionBoxWidth()&&e>=this.getCollisionBoxY()&&e<=this.getCollisionBoxY()+this.getCollisionBoxHeight()},t.prototype.collidesWithX=function(t){return t>=this.getCollisionBoxX()&&t<=this.getCollisionBoxX()+this.getCollisionBoxWidth()},t.prototype.collidesWithY=function(t){return t>=this.getCollisionBoxY()&&t<=this.getCollisionBoxY()+this.getCollisionBoxHeight()},t.prototype.getCollisionBoxX=function(){return this.hasRotation()?this.getRotatedScaledX()+t.AntiAliasCorrection.coordinateOffset:this.getScaledX()+t.AntiAliasCorrection.coordinateOffset},t.prototype.getCollisionBoxY=function(){return this.hasRotation()?this.getRotatedScaledY()+t.AntiAliasCorrection.coordinateOffset:this.getScaledY()+t.AntiAliasCorrection.coordinateOffset},t.prototype.getCollisionBoxWidth=function(){return this.hasRotation()?this.getScaledDiagonalSize()+t.AntiAliasCorrection.sizeAdjustment:this.getScaledWidth()+t.AntiAliasCorrection.sizeAdjustment},t.prototype.getCollisionBoxHeight=function(){return this.hasRotation()?this.getScaledDiagonalSize()+t.AntiAliasCorrection.sizeAdjustment:this.getScaledHeight()+t.AntiAliasCorrection.sizeAdjustment},t.prototype.handleMouseEvent=function(t){var e=this._setupSecondaryEventData(t),i=[];if(this.collidesWithCoordinates(t.data.viewOriginAdjustedX,t.data.viewOriginAdjustedY)){this.isMouseOver()||i.push(new o.SLGfxMouseEvent(r.EventType.MOUSE_ENTER_ELEMENT,e,t.data.time)),this._mouseIsOver=!0;var n=void 0;switch(t.type){case r.EventType.MOUSE_MOVE:n=r.EventType.MOUSE_MOVE_OVER_ELEMENT;break;case r.EventType.MOUSE_DOWN:n=r.EventType.MOUSE_DOWN_ON_ELEMENT;break;case r.EventType.MOUSE_UP:n=r.EventType.MOUSE_UP_ON_ELEMENT}i.push(new o.SLGfxMouseEvent(n,e,t.data.time))}else this.isMouseOver()&&(i.push(new o.SLGfxMouseEvent(r.EventType.MOUSE_EXIT_ELEMENT,e,t.data.time)),this._mouseIsOver=!1);for(var s=0;s<i.length;s++){var a=i[s];this.notify(a),a.endEventPropagation&&(t.endEventPropagation=!0)}},t.prototype._setupSecondaryEventData=function(t){return{x:t.data.x,y:t.data.y,viewOriginAdjustedX:t.data.viewOriginAdjustedX,viewOriginAdjustedY:t.data.viewOriginAdjustedY,rawX:t.data.rawX,rawY:t.data.rawY,element:this}},t.id=0,t.AntiAliasCorrection={coordinateOffset:-1,sizeAdjustment:2},t}();e.GfxElement=h},163:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.GfxElementZIndexComparable=void 0;var i=function(){function t(t){this._parentElement=t}return t.prototype.getElement=function(){return this._parentElement},t.prototype.compareTo=function(t){return this._parentElement.getZIndex()<t._parentElement.getZIndex()?-1:this._parentElement.getZIndex()===t._parentElement.getZIndex()?0:1},t.prototype.equals=function(t){return this._parentElement.getZIndex()===t._parentElement.getZIndex()},t.prototype.getKey=function(){return this._parentElement.getId().toString()},t}();e.GfxElementZIndexComparable=i},531:function(t,e,i){var n,o=this&&this.__extends||(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.GfxLayer=void 0;var r=i(57),s=i(555),a=i(857),h=function(t){function e(e){var i=t.call(this,e)||this;return i._elements=[],i._dirtyElements=new r.UniquePriorityQueue,i._dirtyElements.setInvertPriority(!1),i._removedElements={},i._zIndexCounter=0,i._allElementsRemoved=!1,i}return o(e,t),Object.defineProperty(e.prototype,"elements",{get:function(){return this._elements},enumerable:!1,configurable:!0}),e.prototype.addElement=function(t){this._elements.push(t),-1===t.getZIndex()&&t.setZIndex(this._zIndexCounter++)},e.prototype.removeElementById=function(t){var e=this._elements.findIndex((function(e){return e.getId()===t}));return e>-1?this._removeElementByIndex(e):null},e.prototype.removeElement=function(t){return this.removeElementById(t.getId())},e.prototype._removeElementByIndex=function(t){this._removedElements[this._elements[t].getId()]=this._elements[t];var e=this._elements[t];return e.setDirty(!0),e.setHidden(!0),this._dirtyElements.push(e.getZIndexComparable()),e},e.prototype.removeAllElements=function(){for(var t=0;t<this._elements.length;t++)this._removeElementByIndex(t);this._allElementsRemoved=!0},e.prototype.update=function(t,e){for(var i=0;i<this._elements.length;i++)this.isDirty()&&this._elements[i].setDirty(!0),this._elements[i].update(t,e)&&this._dirtyElements.push(this._elements[i].getZIndexComparable()),this._checkBorderCollision(this._elements[i],t);this._handleCollisions()},e.prototype._checkBorderCollision=function(t,e){t.getCollisionBoxX()<=0&&t.notify(new r.Event(s.EventType.ELEMENT_HIT_LEFT_EDGE,{layer:this,element:t},e)),t.getCollisionBoxX()+t.getCollisionBoxWidth()>this.getWidth()&&t.notify(new r.Event(s.EventType.ELEMENT_HIT_RIGHT_EDGE,{layer:this,element:t},e)),t.getCollisionBoxY()<=0&&t.notify(new r.Event(s.EventType.ELEMENT_HIT_TOP_EDGE,{layer:this,element:t},e)),t.getCollisionBoxY()+t.getCollisionBoxHeight()>this.getHeight()&&t.notify(new r.Event(s.EventType.ELEMENT_HIT_BOTTOM_EDGE,{layer:this,element:t},e))},e.prototype._handleCollisions=function(){for(var t,e,i=0;i<this._elements.length-1;i++){t=this._elements[i];for(var n=i+1;n<this._elements.length;n++)e=this._elements[n],this._collisionCheckElementsIfNeeded(t,e)}},e.prototype._collisionCheckElementsIfNeeded=function(t,e){t.collidesWith(e)&&(this._updateElementOnCollision(t),this._updateElementOnCollision(e))},e.prototype._updateElementOnCollision=function(t){t.setHasCollision(!0),this._dirtyElements.push(t.getZIndexComparable())},e.prototype.preRender=function(t,e){if(a.Layer.prototype.preRender.call(this,t,e),!this.isDirty())for(var i=0;i<this._dirtyElements.size();i++)this._dirtyElements.getByIndex(i).getElement().clear(this.getCanvasContextWrapper())},e.prototype.render=function(t,e){for(;this._dirtyElements.peek();){var i=this._dirtyElements.pop().getElement();i.preRender(t,e)&&i.render(this.getCanvasContextWrapper(),t,e),i.postRender(t,e)}this._cleanUp()},e.prototype._cleanUp=function(){var t=this;this._allElementsRemoved?(this._elements=[],this._allElementsRemoved=!1):Object.keys(this._removedElements).forEach((function(e){var i=parseInt(e),n=t._elements.findIndex((function(t){return t.getId()===i}));t._elements.splice(n,1)})),this._removedElements={},this._dirtyElements.clear()},e.prototype.handleMouseEvent=function(t){for(var e=0;e<this._elements.length;e++)this._elements[e].handleMouseEvent(t)},e}(a.Layer);e.GfxLayer=h},883:function(t,e,i){var n=this&&this.__assign||function(){return n=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},n.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.GfxPanel=void 0;var o=i(57),r=i(657),s=i(555),a=i(157),h=i(833),l=function(){function t(t){this._targetElement=t.targetElement,this._layerFactory=t.layerFactory||new a.LayerFactory,this._scaleX=t.scaleX||1,this._scaleY=t.scaleY||1,this._width=(t.width||640)*this._scaleX,this._height=(t.height||480)*this._scaleY,this._fpsElem=t.fpsElement||null,this._imageSmoothingEnabled=t.imageSmoothingEnabled||!1,this._last=0,this._mouseX=-1,this._mouseY=-1,this._mouseMoved=!1,this._paused=!1,this._unpaused=!1,this._useMouseMoveEvents=!!o.Utils.isNullOrUndefined(t.useMouseMoveEvents)||t.useMouseMoveEvents,this._backgroundColor=t.backgroundColor||"black",this._borderColor=t.borderColor||"grey",this._setBorderSize(t.borderSize||1),this._fpsMonitorArray=[],this._fpsMonitorIndex=0,this._viewOriginX=0,this._viewOriginY=0,this._pendingViewOriginX=null,this._pendingViewOriginY=null,this._layers=[],this._eventManager=t.eventManager||new o.EventManager,this._document=t.document||document,this._requestAnimationFrame=t.requestAnimationFrame||(window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(){}),this._prepareDiv(),this._setupEventListeners()}return t.prototype._setBorderSize=function(t){this._borderSize="number"==typeof t?t+"px":t},t.prototype.setViewOriginX=function(t){this._pendingViewOriginX=t,null!==this._pendingViewOriginX&&this._pendingViewOriginX!==this.getViewOriginX()&&this.getLayers().forEach((function(e){e.setViewOriginX(t)}))},t.prototype.setViewOriginY=function(t){this._pendingViewOriginY=t,null!==this._pendingViewOriginY&&this._pendingViewOriginY!==this.getViewOriginY()&&this.getLayers().forEach((function(e){e.setViewOriginY(t)}))},t.prototype.getViewOriginX=function(){return this._viewOriginX},t.prototype.getViewOriginY=function(){return this._viewOriginY},t.prototype.getPendingViewOriginX=function(){return this._pendingViewOriginX},t.prototype.getPendingViewOriginY=function(){return this._pendingViewOriginY},t.prototype._prepareDiv=function(){this._targetElement.style.width=this._width+"px",this._targetElement.style.height=this._height+"px",this._targetElement.style.backgroundColor=this._backgroundColor,this._targetElement.style.border=this._borderSize+" solid "+this._borderColor},t.prototype._setupEventListeners=function(){this._targetElement.addEventListener("mouseup",this._handleMouseEvent.bind(this),!0),this._targetElement.addEventListener("mousedown",this._handleMouseEvent.bind(this),!0),this._useMouseMoveEvents&&this._targetElement.addEventListener("mousemove",this.handleMouseMoveEvent.bind(this),!0),this._document.addEventListener("visibilitychange",this._handleVisibilityChange.bind(this),!1)},t.prototype._handleVisibilityChange=function(){this._tabNotVisible=this._document.hidden,this._tabNotVisible||this._paused||(this._unpaused=!0,this._requestAnimationFrame(this.render.bind(this)))},t.prototype.addEventListenerToDocument=function(t,e){this._document.addEventListener(t,e)},t.prototype.setBackgroundColor=function(t){this._backgroundColor=t,this._targetElement.style.backgroundColor=t},t.prototype.getBackgroundColor=function(){return this._backgroundColor},t.prototype.setBorderColor=function(t){this._borderColor=t,this._targetElement.style.borderColor=t},t.prototype.getBorderColor=function(){return this._borderColor},t.prototype.setBorderSize=function(t){this._setBorderSize(t),this._targetElement.style.borderWidth=this._borderSize},t.prototype.getBorderSize=function(){return this._targetElement.style.borderWidth},t.prototype.getBorderTopSize=function(){return this._targetElement.style.borderTopWidth},t.prototype.getBorderLeftSize=function(){return this._targetElement.style.borderLeftWidth},t.prototype.getBorderRightSize=function(){return this._targetElement.style.borderRightWidth},t.prototype.getBorderBottomSize=function(){return this._targetElement.style.borderBottomWidth},t.prototype.getWidth=function(){return this._width},t.prototype.getHeight=function(){return this._height},t.prototype.getScaleX=function(){return this._scaleX},t.prototype.getScaleY=function(){return this._scaleY},t.prototype.getMouseX=function(){return this._mouseX},t.prototype.getMouseY=function(){return this._mouseY},t.prototype.isImageSmoothingEnabled=function(){return this._imageSmoothingEnabled},t.prototype.setImageSmoothingEnabled=function(t){this._imageSmoothingEnabled=t},t.prototype.createLayer=function(t,e){e=e||{};var i=this.createCanvasForLayer(),o=this.createCanvasContextWrapper(i),r=n({},e);r.width=r.width||this.getWidth(),r.height=r.height||this.getHeight(),r.canvasContextWrapper=o;var s=this._layerFactory.createLayer(t,r);return this.addLayer(s),s},t.prototype.createCanvasForLayer=function(){var t=this._document.createElement("CANVAS");return this._targetElement.appendChild(t),t.width=this._width,t.height=this._height,t.style.position="absolute",t},t.prototype.createCanvasContextWrapper=function(t){return new r.CanvasContextWrapper({canvasContext:t.getContext("2d"),imageSmoothingEnabled:this._imageSmoothingEnabled,width:this._width,height:this._height})},t.prototype.addLayer=function(t){this._layers.push(t)},t.prototype.getLayers=function(){return this._layers},t.prototype.setPaused=function(t){this._paused&&!t&&(this._unpaused=!0),this._paused=t,this._eventManager.notify(new o.Event(this._paused?s.EventType.SCREEN_PAUSED:s.EventType.SCREEN_RESUMED,{})),this._paused||this._requestAnimationFrame(this.render.bind(this))},t.prototype.onNextFrameBegin=function(t){this._eventManager.on(s.EventType.NEXT_FRAME_BEGIN,t)},t.prototype.onNextFrameEnd=function(t){this._eventManager.on(s.EventType.NEXT_FRAME_END,t)},t.prototype._doBeforeRenderEvents=function(t,e){this._eventManager.notify(new o.Event(s.EventType.NEXT_FRAME_BEGIN,{diff:e},t)),this._eventManager.clearEventListeners(s.EventType.NEXT_FRAME_BEGIN),this._eventManager.notify(new o.Event(s.EventType.BEFORE_RENDER,{diff:e},t))},t.prototype._doAfterRenderEvents=function(t,e){this._eventManager.notify(new o.Event(s.EventType.NEXT_FRAME_END,{diff:e},t)),this._eventManager.clearEventListeners(s.EventType.NEXT_FRAME_END),this._eventManager.notify(new o.Event(s.EventType.AFTER_RENDER,{diff:e},t))},t.prototype.isPaused=function(){return this._paused},t.prototype.render=function(t){if(t=t||1,!this._paused&&!this._tabNotVisible){this._unpaused&&(this._unpaused=!1,this._last=Math.floor(t)-1),t=Math.floor(t);var e=Date.now(),i=t-this._last;this._last=t,this._mouseMoved&&this._handleMouseMoveEvent(t),this._doBeforeRenderEvents(t,i),this._updateFps(i),this._update(t,i),this._render(t,i),this._updateViewOrigins(),this._doAfterRenderEvents(t,i),e=Date.now()-e,this._fpsElem&&0===this._fpsMonitorIndex&&(this._fpsElem.innerHTML+="<br />Avg MS per frame: "+e),this._requestAnimationFrame(this.render.bind(this))}},t.prototype._updateViewOrigins=function(){o.Utils.isNullOrUndefined(this.getPendingViewOriginX())||(this._viewOriginX=this.getPendingViewOriginX(),this._pendingViewOriginX=null),o.Utils.isNullOrUndefined(this.getPendingViewOriginY())||(this._viewOriginY=this.getPendingViewOriginY(),this._pendingViewOriginY=null)},t.prototype._handleMouseMoveEvent=function(t){var e=this._getDataForMouseEvent(this._mouseX,this._mouseY),i=new h.SLGfxMouseEvent(s.EventType.MOUSE_MOVE,e,t);this._propagateMouseEventThroughLayers(i),i.endEventPropagation||this._eventManager.notify(i),this._mouseMoved=!1},t.prototype._updateFps=function(t){if(this._fpsElem){var e=Math.floor(1e3/t);this._fpsMonitorArray.length<30?this._fpsMonitorArray.push(e):this._fpsMonitorArray[this._fpsMonitorIndex]=e,this._fpsMonitorIndex++,this._fpsMonitorIndex>=30&&(this._fpsMonitorIndex=0);for(var i=1,n=0;n<this._fpsMonitorArray.length;n++)i+=this._fpsMonitorArray[n]/30;this._fpsElem&&0===this._fpsMonitorIndex&&(this._fpsElem.innerHTML="fps: "+Math.floor(i))}},t.prototype._update=function(t,e){for(var i=0;i<this._layers.length;i++)this._layers[i].update(t,e)},t.prototype._render=function(t,e){for(var i=0;i<this._layers.length;i++)this._layers[i].preRender(t,e),this._layers[i].render(t,e),this._layers[i].postRender(t,e)},t.prototype.handleMouseMoveEvent=function(t){if(this._paused)return!1;this._mouseMoved=!0;var e=this.getXFromMouseEvent(t),i=this.getYFromMouseEvent(t);if(e<0||e>=this._width||i<0||i>=this._height)return this._mouseX=-1,this._mouseY=-1,!1;this._mouseX=e,this._mouseY=i},t.prototype._getDataForMouseEvent=function(t,e){var i=this.getViewOriginAdjustedX(t),n=this.getViewOriginAdjustedY(e);return{x:this.getUnScaledX(i),y:this.getUnScaledY(n),viewOriginAdjustedX:i,viewOriginAdjustedY:n,rawX:t,rawY:e}},t.prototype._handleMouseEvent=function(t){if(this._paused)return!1;var e=this.getXFromMouseEvent(t),i=this.getYFromMouseEvent(t);if(e<0||e>=this._width||i<0||i>=this._height)return!1;var n=this._getDataForMouseEvent(e,i),o="mouseup"===t.type?s.EventType.MOUSE_UP:s.EventType.MOUSE_DOWN,r=new h.SLGfxMouseEvent(o,n);return this._propagateMouseEventThroughLayers(r),r.endEventPropagation||this._eventManager.notify(r),1!==t.button&&void 0},t.prototype._propagateMouseEventThroughLayers=function(t){for(var e=this._layers.length-1;e>=0;e--){if(t.endEventPropagation)return;this._layers[e].handleMouseEvent(t)}},t.prototype.getXFromMouseEvent=function(t){return t.pageX-(this._targetElement.offsetLeft+parseInt(this.getBorderLeftSize()))},t.prototype.getYFromMouseEvent=function(t){return t.pageY-(this._targetElement.offsetTop+parseInt(this.getBorderTopSize()))},t.prototype.getUnScaledX=function(t){return Math.floor(t/this.getScaleX())},t.prototype.getUnScaledY=function(t){return Math.floor(t/this.getScaleY())},t.prototype.getViewOriginAdjustedX=function(t){return t-this.getViewOriginX()},t.prototype.getViewOriginAdjustedY=function(t){return t-this.getViewOriginY()},t.prototype.setBorder=function(t,e,i){this._targetElement.style.borderWidth=t,this._targetElement.style.borderStyle=e,this._targetElement.style.borderColor=i},t.prototype.addEventListener=function(t,e,i){return this._eventManager.addEventListener(t,e,i)},t.prototype.on=function(t,e,i){return this.addEventListener(t,e,i)},t.prototype.removeEventListener=function(t){this._eventManager.removeEventListener(t)},t.prototype.clearEventListeners=function(t){this._eventManager.clearEventListeners(t)},t.prototype.notify=function(t,e,i){t instanceof o.Event?this._eventManager.notify(t):this._eventManager.notify(t,e,i)},t}();e.GfxPanel=l},612:function(t,e,i){var n,o=this&&this.__extends||(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.ImageElement=void 0;var r=function(t){function e(e){var i=t.call(this,e)||this;return i._image=e.image,i._sx=e.sourceX,i._sy=e.sourceY,i._sWidth=e.sourceWidth,i._sHeight=e.sourceHeight,i._imageRenderer=e.imageRenderer,i}return o(e,t),e.prototype.getImage=function(){return this._image},e.prototype.getWidth=function(){return this._sWidth},e.prototype.getHeight=function(){return this._sHeight},e.prototype.getSourceX=function(){return this._sx},e.prototype.getSourceY=function(){return this._sy},e.prototype.getSourceWidth=function(){return this._sWidth},e.prototype.getSourceHeight=function(){return this._sHeight},e.prototype.render=function(t,e,i){this._imageRenderer.renderImage(t,this.getImage(),this.getSourceX(),this.getSourceY(),this.getSourceWidth(),this.getSourceHeight(),this.getX(),this.getY(),this.getWidth(),this.getHeight(),this.getElementScaleX(),this.getElementScaleY(),this.isHorizontallyFlipped(),this.isVerticallyFlipped(),this.getRotation())},e}(i(388).GfxElement);e.ImageElement=r},158:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ImageLoader=void 0;var i=function(){function t(){}return t.prototype.loadImages=function(t,e,i){var n=this,o=(Object.keys(t).length,{}),r=function(r){o[r]=new Image,o[r].src=t[r],o[r].onload=function(){return n.loadImagesCallback(r,o,e,i)}};for(var s in t)r(s)},t.prototype.loadImagesCallback=function(t,e,i,n){var o=Object.entries(e).filter((function(t){return t[1].complete})).map((function(t){return t[0]})),r=o.length,s=Object.keys(e).length;n&&n({lastLoadedImageKey:t,loadedCount:r,totalImageCount:s,loadedImageKeys:o}),r===s&&i(e)},t}();e.ImageLoader=i},788:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ImageRenderer=void 0;var n=i(675),o=function(){function t(t,e){void 0===t&&(t=1),void 0===e&&(e=1),this._screenScaleX=t,this._screenScaleY=e}return t.prototype.renderImage=function(t,e,i,n,o,r,s,a,h,l,u,p,_,c,d){_||c||d?this.renderImageWithTranslation(t,e,i,n,o,r,s,a,h,l,u,p,_,c,d):t.drawImage(e,i,n,o,r,s*this.getScreenScaleX(),a*this.getScreenScaleY(),h*this.getTotalScaleX(u),l*this.getTotalScaleY(p))},t.prototype.renderImageWithTranslation=function(t,e,i,o,r,s,a,h,l,u,p,_,c,d,f){var y=this,g=a*this.getScreenScaleX()+l*this.getTotalScaleX(p)/2,v=h*this.getScreenScaleY()+u*this.getTotalScaleY(_)/2;n.Utils.renderWithTranslation(t,g,v,c,d,f,(function(){t.drawImageWithTranslation(e,i,o,r,s,0-l*y.getTotalScaleX(p)/2,0-u*y.getTotalScaleY(_)/2,l*y.getTotalScaleX(p),u*y.getTotalScaleY(_))}))},t.prototype.getScreenScaleX=function(){return this._screenScaleX},t.prototype.getScreenScaleY=function(){return this._screenScaleY},t.prototype.getTotalScaleX=function(t){return this._screenScaleX*t},t.prototype.getTotalScaleY=function(t){return this._screenScaleY*t},t}();e.ImageRenderer=o},701:function(t,e,i){var n,o=this&&this.__extends||(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.ImageSprite=void 0;var r=function(t){function e(e){var i=t.call(this,e)||this;return i._image=e.image,i._sWidth=e.width,i._sHeight=e.height,i._imageRenderer=e.imageRenderer,i}return o(e,t),e.prototype.getImage=function(){return this._image},e.prototype.renderFrame=function(t,e,i,n){this._imageRenderer.renderImage(t,this.getImage(),n.getSourceX(),n.getSourceY(),n.getSourceWidth(),n.getSourceHeight(),this.getX(),this.getY(),this.getWidth(),this.getHeight(),this.getElementScaleX(),this.getElementScaleY(),this.isHorizontallyFlipped(),this.isVerticallyFlipped(),this.getRotation())},e.prototype.getWidth=function(){return this._sWidth},e.prototype.getHeight=function(){return this._sHeight},e}(i(653).Sprite);e.ImageSprite=r},151:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ImageSpriteFrame=void 0;var i=function(){function t(t){this._duration=t.duration,this._sx=t.sourceX,this._sy=t.sourceY,this._sWidth=t.sourceWidth,this._sHeight=t.sourceHeight}return t.prototype.getDuration=function(){return this._duration},t.prototype.getSourceX=function(){return this._sx},t.prototype.getSourceY=function(){return this._sy},t.prototype.getSourceWidth=function(){return this._sWidth},t.prototype.getSourceHeight=function(){return this._sHeight},t}();e.ImageSpriteFrame=i},857:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Layer=void 0;var n=i(57),o=function(){function t(t){this._width=t.width||320,this._height=t.height||200,this._canvasContextWrapper=t.canvasContextWrapper,this._dirty=!0,this._pendingViewOriginX=null,this._pendingViewOriginY=null}return t.prototype.isDirty=function(){return this._dirty},t.prototype.setDirty=function(t){this._dirty=t},t.prototype.setViewOriginX=function(t){this._pendingViewOriginX=t,null!==this._pendingViewOriginX&&this._pendingViewOriginX!==this.getViewOriginX()&&this.setDirty(!0)},t.prototype.setViewOriginY=function(t){this._pendingViewOriginY=t,null!==this._pendingViewOriginY&&this._pendingViewOriginY!==this.getViewOriginY()&&this.setDirty(!0)},t.prototype.getViewOriginX=function(){return this._canvasContextWrapper.getViewOriginX()},t.prototype.getViewOriginY=function(){return this._canvasContextWrapper.getViewOriginY()},t.prototype.getWidth=function(){return this._width},t.prototype.getHeight=function(){return this._height},t.prototype.getCanvasContextWrapper=function(){return this._canvasContextWrapper},t.prototype.isImageSmoothingEnabled=function(){return this._canvasContextWrapper.isImageSmoothingEnabled()},t.prototype.setImageSmoothingEnabled=function(t){this._canvasContextWrapper.setImageSmoothingEnabled(t),this.setDirty(!0)},t.prototype.preRender=function(t,e){this.isDirty()&&this.getCanvasContextWrapper().clear(),n.Utils.isNullOrUndefined(this._pendingViewOriginX)||(this.getCanvasContextWrapper().setViewOriginX(this._pendingViewOriginX),this._pendingViewOriginX=null),n.Utils.isNullOrUndefined(this._pendingViewOriginY)||(this.getCanvasContextWrapper().setViewOriginY(this._pendingViewOriginY),this._pendingViewOriginY=null)},t.prototype.postRender=function(t,e){this.setDirty(!1)},t.prototype.clearLayer=function(){this._canvasContextWrapper.clearRect(0,0,this.getWidth(),this.getHeight())},t.prototype.dimLayer=function(t,e,i){var n=t/e;setTimeout(this._dimStep.bind(this,n,n,e,i),i)},t.prototype._dimStep=function(t,e,i,n){var o=this.getCanvasContextWrapper();o.clearRect(0,0,this.getWidth(),this.getHeight()),o.setFillStyle("rgba(0,0,0,".concat(t,")")),o.fillRect(0,0,this.getWidth(),this.getHeight()),i>0&&setTimeout(this._dimStep.bind(this,t+e,e,i-1,n),n)},t}();e.Layer=o},157:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.LayerFactory=void 0;var n=i(57),o=i(493),r=i(531),s=function(){function t(e){var i=this;e=e||{},this._registeredTypes={},Object.keys(t.DefaultTypes).forEach((function(e){i._registeredTypes[e]=t.DefaultTypes[e]})),Object.keys(e).forEach((function(t){i._registeredTypes[t]=e[t]}))}return t.prototype.createLayer=function(t,e){var i,o=this._registeredTypes[t];return o&&n.Utils.isFunction(o)&&(i=o(e)),i},t.DefaultTypes={GfxLayer:function(t){return new r.GfxLayer(t)},BackgroundLayer:function(t){return new o.BackgroundLayer(t)}},t}();e.LayerFactory=s},438:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.MoveOrder=void 0;var n=i(57),o=function(){function t(t,e,i,n,o,r){this._element=t,this._tx=e,this._ty=i,this._startX=0,this._startY=0,this._duration=n,this._timeElapsed=0,this._elementCallback=o,this._callback=r,this._end=!1,this._started=!1}return t.prototype.start=function(){this._startX=this._element.getX(),this._startY=this._element.getY(),this._started=!0},t.prototype.update=function(t){if(this._started&&!this._end){this._timeElapsed+=t;var e=this._timeElapsed/this._duration;e>=1?this.end():(this._element.setX(this._startX+(this._tx-this._startX)*e),this._element.setY(this._startY+(this._ty-this._startY)*e))}},t.prototype.end=function(){this._end=!0,this._element.setX(this._tx),this._element.setY(this._ty),n.Utils.isFunction(this._elementCallback)&&this._elementCallback(),n.Utils.isFunction(this._callback)&&this._callback(this._element)},t}();e.MoveOrder=o},833:function(t,e,i){var n,o=this&&this.__extends||(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.SLGfxMouseEvent=void 0;var r=function(t){function e(e,i,n){var o=t.call(this,e,i,n)||this;return o.endEventPropagation=!1,o}return o(e,t),e}(i(57).Event);e.SLGfxMouseEvent=r},653:function(t,e,i){var n,o=this&&this.__extends||(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.Sprite=void 0;var r=i(555),s=i(388),a=i(57),h=function(t){function e(e){var i=t.call(this,e)||this;return i._frames=e.frames||[],i._ttl=e.ttl||-1,i._loop=!1!==e.loop,i._loopsToLive=e.loopsToLive||-1,i._freezeFrameIdx=e.freezeFrameIdx||-1,i._fidx=0,i._currentFrameElapsed=0,i._done=!1,i._loopCount=0,i._elapsed=0,i}return o(e,t),e.prototype.getFrames=function(){return this._frames},e.prototype.setFrames=function(t){this._frames=t},e.prototype.addFrame=function(t){this._frames.push(t)},e.prototype.getTtl=function(){return this._ttl},e.prototype.setTtl=function(t){this._ttl=t},e.prototype.doesLoop=function(){return this._loop},e.prototype.setDoLoop=function(t){this._loop=t},e.prototype.getLoopsToLive=function(){return this._loopsToLive},e.prototype.setLoopsToLive=function(t){this._loopsToLive=t},e.prototype.isDone=function(){return this._done},e.prototype.setDone=function(t){this._done=t,t&&this.doEndOfAnimation()},e.prototype.getFreezeFrameIndex=function(){return this._freezeFrameIdx},e.prototype.setFreezeFrameIndex=function(t){this._freezeFrameIdx=t},e.prototype.getLoopCount=function(){return this._loopCount},e.prototype.getCurrentFrameIndex=function(){return this._fidx},e.prototype.setCurrentFrameIndex=function(t){this._fidx=t,this.setDirty(!0)},e.prototype.reset=function(){this.setCurrentFrameIndex(0),this._currentFrameElapsed=0,this._done=!1,this._loopCount=0,this._elapsed=0,this.setDirty(!0)},e.prototype.update=function(t,e){return s.GfxElement.prototype.update.call(this,t,e),0===this._frames.length||this._done?null:(this._updateTtl(e),this._updateFrame(e),this._done&&this.doEndOfAnimation(),this.isDirty()?this:null)},e.prototype._updateFrame=function(t){if(this._currentFrameElapsed+=t,this._currentFrameElapsed>=this._frames[this._fidx].getDuration()){for(;this._currentFrameElapsed>=this._frames[this._fidx].getDuration();)this._currentFrameElapsed-=this._frames[this._fidx].getDuration(),this._fidx++,this._fidx===this._frames.length&&(this._fidx=0,this._loopCount++,this._loop?this._loopsToLive>-1&&this._loopCount>=this._loopsToLive&&(this._done=!0):(this._done=!0,this._freezeFrameIdx>-1&&(this._fidx=this._freezeFrameIdx)));this.setDirty(!0)}},e.prototype._updateTtl=function(t){this._ttl>-1&&(this._elapsed+=t,this._elapsed>=this._ttl&&(this._done=!0))},e.prototype.render=function(t,e,i){this.renderFrame(t,e,i,this._frames[this._fidx])},e.prototype.doEndOfAnimation=function(){var t=new a.Event(r.EventType.SPRITE_ANIMATION_DONE,{element:this});this.notify(t)},e}(s.GfxElement);e.Sprite=h},675:function(t,e,i){var n,o=this&&this.__extends||(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.Utils=void 0;var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.renderWithTranslation=function(t,i,n,o,r,s,a){t.save(),e.translateCanvasContext(t,i,n,o,r,s),a(),t.restore()},e.translateCanvasContext=function(t,e,i,n,o,r){t.translate(e,i),(n||o)&&t.scale(n?-1:1,o?-1:1),r&&t.rotate(r)},e.prototype.clearCanvasContext=function(t){t.clearRect(0,0,t.canvas.width,t.canvas.height)},e}(i(57).Utils);e.Utils=r}},e={};function i(n){var o=e[n];if(void 0!==o)return o.exports;var r=e[n]={exports:{}};return t[n].call(r.exports,r,r.exports,i),r.exports}var n={};return(()=>{var t=n;Object.defineProperty(t,"__esModule",{value:!0}),t.Utils=t.Sprite=t.SLGfxMouseEvent=t.GfxPanel=t.MoveOrder=t.LayerFactory=t.Layer=t.ImageSpriteFrame=t.ImageSprite=t.ImageRenderer=t.ImageLoader=t.ImageElement=t.GfxLayer=t.GfxElementZIndexComparable=t.GfxElement=t.EventType=t.CanvasContextWrapper=t.BackgroundLayer=void 0;var e=i(493);Object.defineProperty(t,"BackgroundLayer",{enumerable:!0,get:function(){return e.BackgroundLayer}});var o=i(657);Object.defineProperty(t,"CanvasContextWrapper",{enumerable:!0,get:function(){return o.CanvasContextWrapper}});var r=i(555);Object.defineProperty(t,"EventType",{enumerable:!0,get:function(){return r.EventType}});var s=i(388);Object.defineProperty(t,"GfxElement",{enumerable:!0,get:function(){return s.GfxElement}});var a=i(163);Object.defineProperty(t,"GfxElementZIndexComparable",{enumerable:!0,get:function(){return a.GfxElementZIndexComparable}});var h=i(531);Object.defineProperty(t,"GfxLayer",{enumerable:!0,get:function(){return h.GfxLayer}});var l=i(612);Object.defineProperty(t,"ImageElement",{enumerable:!0,get:function(){return l.ImageElement}});var u=i(158);Object.defineProperty(t,"ImageLoader",{enumerable:!0,get:function(){return u.ImageLoader}});var p=i(788);Object.defineProperty(t,"ImageRenderer",{enumerable:!0,get:function(){return p.ImageRenderer}});var _=i(701);Object.defineProperty(t,"ImageSprite",{enumerable:!0,get:function(){return _.ImageSprite}});var c=i(151);Object.defineProperty(t,"ImageSpriteFrame",{enumerable:!0,get:function(){return c.ImageSpriteFrame}});var d=i(857);Object.defineProperty(t,"Layer",{enumerable:!0,get:function(){return d.Layer}});var f=i(157);Object.defineProperty(t,"LayerFactory",{enumerable:!0,get:function(){return f.LayerFactory}});var y=i(438);Object.defineProperty(t,"MoveOrder",{enumerable:!0,get:function(){return y.MoveOrder}});var g=i(883);Object.defineProperty(t,"GfxPanel",{enumerable:!0,get:function(){return g.GfxPanel}});var v=i(833);Object.defineProperty(t,"SLGfxMouseEvent",{enumerable:!0,get:function(){return v.SLGfxMouseEvent}});var E=i(653);Object.defineProperty(t,"Sprite",{enumerable:!0,get:function(){return E.Sprite}});var m=i(675);Object.defineProperty(t,"Utils",{enumerable:!0,get:function(){return m.Utils}})})(),n})()}));